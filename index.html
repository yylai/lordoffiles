<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lord of Flies - Score Distribution Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        /* Custom CSS inspired by shadcn/ui */
        .card {
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        
        .card-header {
            padding: 1.5rem 1.5rem 0 1.5rem;
        }
        
        .card-content {
            padding: 1.5rem;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.25;
            color: #111827;
        }
        
        .card-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            padding: 0.5rem 1rem;
        }
        
        .button-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .button-primary:hover {
            background-color: #2563eb;
        }
        
        .button-secondary {
            background-color: #f9fafb;
            color: #374151;
            border: 1px solid #d1d5db;
        }
        
        .button-secondary:hover {
            background-color: #f3f4f6;
        }
        
        .select {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            background: white;
            min-width: 180px;
        }
        
        .select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">Lord of Flies Analytics</h1>
            <p class="text-gray-600">Visualize and analyze score distributions across different datasets</p>
        </div>
        
        <div class="mb-6 flex flex-wrap gap-4 items-center">
            <div>
                <label for="datasetSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Dataset:</label>
                <select id="datasetSelect" class="select">
                    <option value="all">All Datasets Combined</option>
                    <option value="dood-bully">Dood Bully</option>
                    <option value="doxmuddler">Dox Muddler</option>
                    <option value="negativenancy">Negative Nancy</option>
                    <option value="trollalot">Troll A Lot</option>
                </select>
            </div>
            
            <div>
                <label for="binSize" class="block text-sm font-medium text-gray-700 mb-2">Bin Size:</label>
                <select id="binSize" class="select">
                    <option value="10">10 points</option>
                    <option value="25" selected>25 points</option>
                    <option value="50">50 points</option>
                    <option value="100">100 points</option>
                </select>
            </div>
            
            <div class="flex items-end">
                <button id="updateChart" class="button button-primary">Update Chart</button>
            </div>
        </div>
        
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">-</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgScore">-</div>
                <div class="stat-label">Average Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxScore">-</div>
                <div class="stat-label">Max Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="zeroScores">-</div>
                <div class="stat-label">Zero Scores</div>
            </div>
        </div>
        
        <!-- Chart Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Score Distribution Histogram</h2>
                <p class="card-description">Distribution of user scores across the selected dataset(s)</p>
            </div>
            <div class="card-content">
                <div style="position: relative; height: 400px;">
                    <canvas id="histogramChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Data Table -->
        <div class="card mt-8">
            <div class="card-header">
                <h2 class="card-title">Top Performers</h2>
                <p class="card-description">Users with the highest scores in the selected dataset</p>
            </div>
            <div class="card-content">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Rank</th>
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Name</th>
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Score</th>
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Dataset</th>
                            </tr>
                        </thead>
                        <tbody id="topPerformersTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let allData = {};
        let currentChart = null;
        
        // Load all JSON data
        async function loadData() {
            const datasets = ['dood-bully', 'doxmuddler', 'negativenancy', 'trollalot'];
            
            for (const dataset of datasets) {
                try {
                    const response = await fetch(`./data/${dataset}.json`);
                    const data = await response.json();
                    allData[dataset] = data.map(item => ({
                        ...item,
                        score: parseInt(item.score),
                        rank: parseInt(item.rank)
                    }));
                } catch (error) {
                    console.error(`Error loading ${dataset}:`, error);
                }
            }
            
            // Initial chart render
            updateVisualization();
        }
        
        // Create histogram data
        function createHistogramData(data, binSize) {
            const scores = data.map(item => item.score);
            const maxScore = Math.max(...scores);
            const minScore = Math.min(...scores);
            
            // Create bins
            const bins = [];
            for (let i = minScore; i <= maxScore; i += binSize) {
                bins.push({
                    min: i,
                    max: i + binSize - 1,
                    count: 0,
                    label: `${i}-${i + binSize - 1}`
                });
            }
            
            // Count scores in each bin
            scores.forEach(score => {
                const binIndex = Math.floor((score - minScore) / binSize);
                if (bins[binIndex]) {
                    bins[binIndex].count++;
                }
            });
            
            return bins;
        }
        
        // Update statistics
        function updateStats(data) {
            const scores = data.map(item => item.score);
            const totalUsers = data.length;
            const avgScore = scores.reduce((a, b) => a + b, 0) / totalUsers;
            const maxScore = Math.max(...scores);
            const zeroScores = scores.filter(score => score === 0).length;
            
            document.getElementById('totalUsers').textContent = totalUsers.toLocaleString();
            document.getElementById('avgScore').textContent = avgScore.toFixed(1);
            document.getElementById('maxScore').textContent = maxScore.toLocaleString();
            document.getElementById('zeroScores').textContent = zeroScores.toLocaleString();
        }
        
        // Update top performers table
        function updateTopPerformers(data, datasetName) {
            const sortedData = [...data].sort((a, b) => b.score - a.score);
            const top10 = sortedData.slice(0, 10);
            
            const tableBody = document.getElementById('topPerformersTable');
            tableBody.innerHTML = '';
            
            top10.forEach((user, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-2 px-4">${index + 1}</td>
                    <td class="py-2 px-4 font-medium">${user.name}</td>
                    <td class="py-2 px-4">${user.score.toLocaleString()}</td>
                    <td class="py-2 px-4">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                            ${datasetName}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Update chart and visualization
        function updateVisualization() {
            const selectedDataset = document.getElementById('datasetSelect').value;
            const binSize = parseInt(document.getElementById('binSize').value);
            
            let data = [];
            let datasetName = '';
            
            if (selectedDataset === 'all') {
                // Combine all datasets
                data = Object.values(allData).flat();
                datasetName = 'All Datasets';
            } else {
                data = allData[selectedDataset] || [];
                datasetName = selectedDataset.charAt(0).toUpperCase() + selectedDataset.slice(1).replace('-', ' ');
            }
            
            if (data.length === 0) return;
            
            // Create histogram
            const histogramData = createHistogramData(data, binSize);
            
            // Update statistics
            updateStats(data);
            
            // Update top performers
            updateTopPerformers(data, datasetName);
            
            // Update chart
            const ctx = document.getElementById('histogramChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: histogramData.map(bin => bin.label),
                    datasets: [{
                        label: 'Number of Users',
                        data: histogramData.map(bin => bin.count),
                        backgroundColor: 'rgba(59, 130, 246, 0.6)',
                        borderColor: 'rgba(59, 130, 246, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: `Score Distribution - ${datasetName}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Users'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Score Range'
                            }
                        }
                    }
                }
            });
        }
        
        // Event listeners
        document.getElementById('updateChart').addEventListener('click', updateVisualization);
        document.getElementById('datasetSelect').addEventListener('change', updateVisualization);
        document.getElementById('binSize').addEventListener('change', updateVisualization);
        
        // Initialize
        loadData();
    </script>
</body>
</html>