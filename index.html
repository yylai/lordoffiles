<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lord of Files - Score Distribution Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        /* Custom CSS inspired by shadcn/ui */
        .card {
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .card-header {
            padding: 1.5rem 1.5rem 0 1.5rem;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.25;
            color: #111827;
        }

        .card-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            padding: 0.5rem 1rem;
        }

        .button-primary {
            background-color: #3b82f6;
            color: white;
        }

        .button-primary:hover {
            background-color: #2563eb;
        }

        .button-secondary {
            background-color: #f9fafb;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .button-secondary:hover {
            background-color: #f3f4f6;
        }

        .select {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            background: white;
            min-width: 180px;
        }

        .select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        /* Manager icons */
        .manager-icon {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            object-fit: cover;
            margin-right: 12px;
            flex-shrink: 0;
        }

        /* Prevent layout shifts */
        .stat-card {
            min-height: 80px;
        }

        .card-title {
            min-height: 2rem;
        }

        /* Ensure stable icon container */
        #performersIcon,
        #histogramIcon {
            display: inline-block;
            width: 80px;
            height: 80px;
            vertical-align: middle;
        }

        /* Background overlay to reduce contrast */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('images/Doodles_background_01 2.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            z-index: -1;
        }

        /* Department ranking cards */
        .dept-rank-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }

        .dept-rank-card.rank-1 {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fef3c7 0%, #ffffff 100%);
        }

        .dept-rank-card.rank-2 {
            border-color: #9ca3af;
            background: linear-gradient(135deg, #f3f4f6 0%, #ffffff 100%);
        }

        .dept-rank-card.rank-3 {
            border-color: #d97706;
            background: linear-gradient(135deg, #fed7aa 0%, #ffffff 100%);
        }

        .dept-rank-card[data-department="bully"] {
            background: rgba(129, 134, 94, 0.2);
            border-color: rgba(129, 134, 94, 0.5);
        }

        .dept-rank-card[data-department="doxmuddler"] {
            background: rgba(95, 97, 135, 0.2);
            border-color: rgba(95, 97, 135, 0.5);
        }

        .dept-rank-card[data-department="negativenancy"] {
            background: rgba(127, 96, 134, 0.2);
            border-color: rgba(127, 96, 134, 0.5);
        }

        .dept-rank-card[data-department="trollalot"] {
            background: rgba(136, 96, 96, 0.2);
            border-color: rgba(136, 96, 96, 0.5);
        }

        .dept-rank-card[data-department="bully"] .dept-rank-number {
            background-color: rgb(129, 134, 94);
            color: white;
        }

        .dept-rank-card[data-department="doxmuddler"] .dept-rank-number {
            background-color: rgb(95, 97, 135);
            color: white;
        }

        .dept-rank-card[data-department="negativenancy"] .dept-rank-number {
            background-color: rgb(127, 96, 134);
            color: white;
        }

        .dept-rank-card[data-department="trollalot"] .dept-rank-number {
            background-color: rgb(136, 96, 96);
            color: white;
        }

        .dept-rank-number {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .dept-rank-number.rank-1 {
            background-color: #fbbf24;
            color: white;
        }

        .dept-rank-number.rank-2 {
            background-color: #9ca3af;
            color: white;
        }

        .dept-rank-number.rank-3 {
            background-color: #d97706;
            color: white;
        }

        .dept-rank-number.rank-4 {
            background-color: #6b7280;
            color: white;
        }

        .dept-manager-info {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .dept-manager-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 0.75rem;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">
                <a href="https://lordofthefiles.xyz/" target="_blank" rel="noopener noreferrer"
                    class="hover:text-blue-600 transition-colors">Lord of Files Analytics</a>
                <a href="#disclaimer" class="text-xs text-gray-500 ml-2 hover:text-gray-700 underline">(data
                    disclaimer)</a>
            </h1>
            <p class="text-gray-600">Visualize and analyze score distributions across different departments</p>
            <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-700">
                    ðŸ“Š All data presented in this dashboard is a snapshot on July 1st, 2025 at 12:35PM PDT.
                </p>
            </div>
        </div>

        <!-- Department Rankings Card -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Department Rankings</h2>
                <p class="card-description">Total scores and performance ranking by department manager</p>
            </div>
            <div class="card-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="departmentRankings">
                    <!-- Department ranking cards will be populated by JavaScript -->
                </div>
            </div>
        </div>




        <!-- Manager Data Analysis Section -->
        <div class="mt-8">
            <!-- Manager Selection -->
            <div class="mb-6 flex justify-start">
                <div>
                    <label for="datasetSelect" class="block text-lg font-bold text-gray-700 mb-2">Select
                        Manager:</label>
                    <select id="datasetSelect" class="select">
                        <option value="all">All</option>
                        <option value="bully">Bully The Kid</option>
                        <option value="doxmuddler">Dox Muddler</option>
                        <option value="negativenancy">Negative Nancy</option>
                        <option value="trollalot">Sir TrollzALot</option>
                    </select>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="stats-grid mb-8">
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">-</div>
                    <div class="stat-label">Total Employees</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalLives">-</div>
                    <div class="stat-label">Total Lives</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalScore">-</div>
                    <div class="stat-label">Total Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="maxScore">-</div>
                    <div class="stat-label">Max Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="medianScore">-</div>
                    <div class="stat-label">Median Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgScore">-</div>
                    <div class="stat-label">Average Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="zeroScores">-</div>
                    <div class="stat-label">Zero Scores</div>
                </div>
            </div>

            <!-- Data Table -->
            <div class="card mt-8">
                <div class="card-header">
                    <h2 class="card-title flex items-center">
                        <span id="performersIcon" class="mr-3"></span>
                        <span>Top Performers</span>
                    </h2>
                    <p class="card-description">Employees with the highest scores in the selected department</p>
                </div>
                <div class="card-content">
                    <div class="flex justify-end mb-2">
                        <input id="searchInput" type="text" placeholder="Search by name" class="select" />
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="border-b">
                                    <th class="text-left py-2 px-4 font-medium text-gray-900">Rank</th>
                                    <th class="text-left py-2 px-4 font-medium text-gray-900">Name</th>
                                    <th class="text-left py-2 px-4 font-medium text-gray-900">Score</th>
                                    <th class="text-left py-2 px-4 font-medium text-gray-900">Lives</th>
                                    <th class="text-left py-2 px-4 font-medium text-gray-900">Department Manager</th>
                                </tr>
                            </thead>
                            <tbody id="topPerformersTable">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <div class="flex items-center justify-between mt-4">
                        <button id="prevPage" class="button button-secondary">Previous</button>
                        <span id="pageInfo" class="text-sm text-gray-600"></span>
                        <button id="nextPage" class="button button-secondary">Next</button>
                    </div>
                </div>
            </div>

            <!-- Chart Card -->
            <div class="card mt-8">
                <div class="card-header">
                    <h2 class="card-title flex items-center">
                        <span id="histogramIcon" class="mr-3"></span>
                        <span id="chartTitle">Score Distribution (Power Law Analysis)</span>
                    </h2>
                    <p id="chartDescription" class="card-description">Employees ranked by score (highest to lowest) to
                        visualize
                        power law distribution</p>
                    <div class="mt-4 flex gap-4">
                        <div>
                            <label for="chartType" class="block text-sm font-medium text-gray-700 mb-2">Chart
                                Type:</label>
                            <select id="chartType" class="select">
                                <option value="powerlaw">Rank Distribution</option>
                                <option value="histogram">Score Histogram</option>
                            </select>
                        </div>
                        <div id="binSizeContainer" style="display: none;">
                            <label for="binSize" class="block text-sm font-medium text-gray-700 mb-2">Bin Size:</label>
                            <select id="binSize" class="select">
                                <option value="1">1 point</option>
                                <option value="10">10 points</option>
                                <option value="25" selected>25 points</option>
                                <option value="50">50 points</option>
                                <option value="100">100 points</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="card-content">
                    <div style="position: relative; height: 400px;">
                        <canvas id="histogramChart"></canvas>
                    </div>
                </div>
            </div>

        </div> <!-- End Manager Data Analysis Section -->

        <!-- Disclaimer -->
        <div id="disclaimer" class="mt-16 p-6 bg-gray-100 border-t border-gray-200">
            <div class="text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Data Disclaimer</h3>
                <p class="text-sm text-gray-600">
                    All data presented in this dashboard is as of July 1st, 2025 at 12:35PM PDT.
                    <br>
                    This information represents a snapshot in time and may not reflect current standings.
                    <br><br>
                    This program calculates statistics and visualizations to the best of its ability but makes no
                    guarantees on the accuracy of the results.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Inline JSON data
        const rawData = {
            'bully': [
    {
        "rank": "1",
        "name": "jivedoodle",
        "lives": "7",
        "score": "669"
    },
    {
        "rank": "2",
        "name": "james_polhill",
        "lives": "5",
        "score": "641"
    },
    {
        "rank": "3",
        "name": "bitrise25",
        "lives": "9",
        "score": "614"
    },
    {
        "rank": "4",
        "name": "soybienmamon",
        "lives": "6",
        "score": "607"
    },
    {
        "rank": "5",
        "name": "0nelinewonder",
        "lives": "5",
        "score": "581"
    },
    {
        "rank": "6",
        "name": "0xbjartek",
        "lives": "5",
        "score": "559"
    },
    {
        "rank": "7",
        "name": "kayshhhmo",
        "lives": "5",
        "score": "543"
    },
    {
        "rank": "8",
        "name": "tasty_snackz",
        "lives": "2",
        "score": "519"
    },
    {
        "rank": "9",
        "name": "streetervilled1",
        "lives": "5",
        "score": "518"
    },
    {
        "rank": "10",
        "name": "mace1337ftw",
        "lives": "4",
        "score": "460"
    },
    {
        "rank": "11",
        "name": "doubtmeharder",
        "lives": "1",
        "score": "429"
    },
    {
        "rank": "12",
        "name": "skeens_jeremy",
        "lives": "6",
        "score": "413"
    },
    {
        "rank": "13",
        "name": "moonshotkongz",
        "lives": "1",
        "score": "409"
    },
    {
        "rank": "14",
        "name": "santandood",
        "lives": "8",
        "score": "394"
    },
    {
        "rank": "15",
        "name": "km404atl",
        "lives": "5",
        "score": "381"
    },
    {
        "rank": "16",
        "name": "doodcollects",
        "lives": "4",
        "score": "379"
    },
    {
        "rank": "17",
        "name": "montiweb3",
        "lives": "5",
        "score": "350"
    },
    {
        "rank": "18",
        "name": "skr_ventures",
        "lives": "2",
        "score": "240"
    },
    {
        "rank": "19",
        "name": "thenftshack",
        "lives": "1",
        "score": "227"
    },
    {
        "rank": "20",
        "name": "bigdaddyerac",
        "lives": "1",
        "score": "208"
    },
    {
        "rank": "21",
        "name": "hazy_purps",
        "lives": "8",
        "score": "199"
    },
    {
        "rank": "22",
        "name": "tonoboon",
        "lives": "1",
        "score": "189"
    },
    {
        "rank": "23",
        "name": "ericdzengeleski",
        "lives": "5",
        "score": "181"
    },
    {
        "rank": "24",
        "name": "tappi365",
        "lives": "2",
        "score": "176"
    },
    {
        "rank": "25",
        "name": "spacecowboy2300",
        "lives": "3",
        "score": "169"
    },
    {
        "rank": "26",
        "name": "happy_dood_",
        "lives": "6",
        "score": "154"
    },
    {
        "rank": "27",
        "name": "jfitz_21",
        "lives": "3",
        "score": "135"
    },
    {
        "rank": "28",
        "name": "dingo522left",
        "lives": "7",
        "score": "135"
    },
    {
        "rank": "29",
        "name": "ohtobisan",
        "lives": "7",
        "score": "131"
    },
    {
        "rank": "30",
        "name": "squ1nch",
        "lives": "5",
        "score": "93"
    },
    {
        "rank": "31",
        "name": "conquant",
        "lives": "4",
        "score": "90"
    },
    {
        "rank": "32",
        "name": "aleon523",
        "lives": "1",
        "score": "73"
    },
    {
        "rank": "33",
        "name": "troyapeman",
        "lives": "7",
        "score": "65"
    },
    {
        "rank": "34",
        "name": "yankun811203",
        "lives": "2",
        "score": "54"
    },
    {
        "rank": "35",
        "name": "tungweb3",
        "lives": "5",
        "score": "43"
    },
    {
        "rank": "36",
        "name": "yuehfengmon",
        "lives": "5",
        "score": "39"
    },
    {
        "rank": "37",
        "name": "beecass_93",
        "lives": "6",
        "score": "24"
    },
    {
        "rank": "38",
        "name": "chouyenchun1",
        "lives": "1",
        "score": "20"
    },
    {
        "rank": "39",
        "name": "0xjunkim",
        "lives": "7",
        "score": "17"
    },
    {
        "rank": "40",
        "name": "0xfbm",
        "lives": "1",
        "score": "4"
    }
],
            'doxmuddler': [
    {
        "rank": "1",
        "name": "vanglog_eth",
        "lives": "1",
        "score": "857"
    },
    {
        "rank": "2",
        "name": "spenc3eth",
        "lives": "8",
        "score": "853"
    },
    {
        "rank": "3",
        "name": "maycl93300",
        "lives": "3",
        "score": "839"
    },
    {
        "rank": "4",
        "name": "ornimusmaximus",
        "lives": "1",
        "score": "797"
    },
    {
        "rank": "5",
        "name": "0xed9",
        "lives": "9",
        "score": "795"
    },
    {
        "rank": "6",
        "name": "akiianurinmokz1",
        "lives": "5",
        "score": "788"
    },
    {
        "rank": "7",
        "name": "tjc345",
        "lives": "10",
        "score": "787"
    },
    {
        "rank": "8",
        "name": "fakukam",
        "lives": "9",
        "score": "783"
    },
    {
        "rank": "9",
        "name": "ippy_world",
        "lives": "5",
        "score": "771"
    },
    {
        "rank": "10",
        "name": "dswagg_dmurph15",
        "lives": "10",
        "score": "764"
    },
    {
        "rank": "11",
        "name": "jusomagi",
        "lives": "3",
        "score": "760"
    },
    {
        "rank": "12",
        "name": "jangdoocheon",
        "lives": "8",
        "score": "758"
    },
    {
        "rank": "13",
        "name": "doodle2713",
        "lives": "1",
        "score": "749"
    },
    {
        "rank": "14",
        "name": "0xringond",
        "lives": "8",
        "score": "739"
    },
    {
        "rank": "15",
        "name": "thorlinck",
        "lives": "1",
        "score": "739"
    },
    {
        "rank": "16",
        "name": "twixcashew",
        "lives": "3",
        "score": "739"
    },
    {
        "rank": "17",
        "name": "semage_",
        "lives": "1",
        "score": "736"
    },
    {
        "rank": "18",
        "name": "ssano122",
        "lives": "3",
        "score": "723"
    },
    {
        "rank": "19",
        "name": "wetlensphotos",
        "lives": "4",
        "score": "722"
    },
    {
        "rank": "20",
        "name": "stack_marketer",
        "lives": "1",
        "score": "705"
    },
    {
        "rank": "21",
        "name": "nftimot",
        "lives": "1",
        "score": "696"
    },
    {
        "rank": "22",
        "name": "heyitsellebee",
        "lives": "4",
        "score": "695"
    },
    {
        "rank": "23",
        "name": "jmrock4700",
        "lives": "10",
        "score": "634"
    },
    {
        "rank": "24",
        "name": "jordan81668033",
        "lives": "9",
        "score": "625"
    },
    {
        "rank": "25",
        "name": "thestevenwarner",
        "lives": "9",
        "score": "610"
    },
    {
        "rank": "26",
        "name": "billybadass_eth",
        "lives": "10",
        "score": "569"
    },
    {
        "rank": "27",
        "name": "pequelord",
        "lives": "3",
        "score": "547"
    },
    {
        "rank": "28",
        "name": "methodsnft",
        "lives": "5",
        "score": "520"
    },
    {
        "rank": "29",
        "name": "haroldr86",
        "lives": "1",
        "score": "493"
    },
    {
        "rank": "30",
        "name": "wintek_nft",
        "lives": "10",
        "score": "454"
    },
    {
        "rank": "31",
        "name": "john_acw",
        "lives": "10",
        "score": "378"
    },
    {
        "rank": "32",
        "name": "jmraymonds",
        "lives": "9",
        "score": "366"
    },
    {
        "rank": "33",
        "name": "iksvitzer",
        "lives": "10",
        "score": "355"
    },
    {
        "rank": "34",
        "name": "realfuple",
        "lives": "10",
        "score": "337"
    },
    {
        "rank": "35",
        "name": "epdrabbit",
        "lives": "1",
        "score": "318"
    },
    {
        "rank": "36",
        "name": "artdoodart",
        "lives": "2",
        "score": "303"
    },
    {
        "rank": "37",
        "name": "zosoiv1971",
        "lives": "6",
        "score": "264"
    },
    {
        "rank": "38",
        "name": "_smx3_",
        "lives": "2",
        "score": "257"
    },
    {
        "rank": "39",
        "name": "csiixty",
        "lives": "1",
        "score": "250"
    },
    {
        "rank": "40",
        "name": "winterpopx",
        "lives": "1",
        "score": "248"
    },
    {
        "rank": "41",
        "name": "paulomcg_",
        "lives": "9",
        "score": "235"
    },
    {
        "rank": "42",
        "name": "darkart",
        "lives": "1",
        "score": "229"
    },
    {
        "rank": "43",
        "name": "troup__",
        "lives": "5",
        "score": "224"
    },
    {
        "rank": "44",
        "name": "jawrrwiii",
        "lives": "10",
        "score": "220"
    },
    {
        "rank": "45",
        "name": "doodlifts",
        "lives": "10",
        "score": "196"
    },
    {
        "rank": "46",
        "name": "maxie_abs",
        "lives": "9",
        "score": "187"
    },
    {
        "rank": "47",
        "name": "porochun",
        "lives": "2",
        "score": "168"
    },
    {
        "rank": "48",
        "name": "jamesgr84741652",
        "lives": "9",
        "score": "146"
    },
    {
        "rank": "49",
        "name": "suv4301",
        "lives": "6",
        "score": "145"
    },
    {
        "rank": "50",
        "name": "abwasabi",
        "lives": "1",
        "score": "135"
    },
    {
        "rank": "51",
        "name": "jerrymeng1799",
        "lives": "5",
        "score": "109"
    },
    {
        "rank": "52",
        "name": "metamonster7777",
        "lives": "9",
        "score": "104"
    },
    {
        "rank": "53",
        "name": "zach_engel98",
        "lives": "2",
        "score": "99"
    },
    {
        "rank": "54",
        "name": "ricardodezoete",
        "lives": "9",
        "score": "95"
    },
    {
        "rank": "55",
        "name": "aashmehtamusic",
        "lives": "4",
        "score": "84"
    },
    {
        "rank": "56",
        "name": "dakaiboy",
        "lives": "1",
        "score": "82"
    },
    {
        "rank": "57",
        "name": "sullyschwartz",
        "lives": "1",
        "score": "81"
    },
    {
        "rank": "58",
        "name": "chefbaycurry",
        "lives": "4",
        "score": "72"
    },
    {
        "rank": "59",
        "name": "jpnspy",
        "lives": "1",
        "score": "68"
    },
    {
        "rank": "60",
        "name": "0xfired",
        "lives": "1",
        "score": "59"
    },
    {
        "rank": "61",
        "name": "cryptot90",
        "lives": "8",
        "score": "57"
    },
    {
        "rank": "62",
        "name": "ilendrick",
        "lives": "1",
        "score": "57"
    },
    {
        "rank": "63",
        "name": "snowi_snowi",
        "lives": "10",
        "score": "55"
    },
    {
        "rank": "64",
        "name": "fr3nchl0af",
        "lives": "1",
        "score": "50"
    },
    {
        "rank": "65",
        "name": "dr_t1313",
        "lives": "10",
        "score": "46"
    },
    {
        "rank": "66",
        "name": "stixhq",
        "lives": "3",
        "score": "41"
    },
    {
        "rank": "67",
        "name": "shadab21x",
        "lives": "10",
        "score": "40"
    },
    {
        "rank": "68",
        "name": "chiapudding000",
        "lives": "8",
        "score": "28"
    },
    {
        "rank": "69",
        "name": "bigbullye",
        "lives": "2",
        "score": "22"
    },
    {
        "rank": "70",
        "name": "0xneskaw",
        "lives": "1",
        "score": "21"
    },
    {
        "rank": "71",
        "name": "waaaaaaaaccky",
        "lives": "5",
        "score": "21"
    },
    {
        "rank": "72",
        "name": "iketheturtle",
        "lives": "2",
        "score": "17"
    },
    {
        "rank": "73",
        "name": "breakwox",
        "lives": "1",
        "score": "17"
    },
    {
        "rank": "74",
        "name": "gemg325",
        "lives": "9",
        "score": "16"
    },
    {
        "rank": "75",
        "name": "beflean",
        "lives": "10",
        "score": "16"
    },
    {
        "rank": "76",
        "name": "jamaalism",
        "lives": "3",
        "score": "9"
    },
    {
        "rank": "77",
        "name": "unkletio",
        "lives": "2",
        "score": "8"
    },
    {
        "rank": "78",
        "name": "mohammadha3764",
        "lives": "1",
        "score": "6"
    },
    {
        "rank": "79",
        "name": "alexmdc",
        "lives": "3",
        "score": "4"
    },
    {
        "rank": "80",
        "name": "wooooote",
        "lives": "9",
        "score": "4"
    }
],
            'negativenancy': [
    {
        "rank": "1",
        "name": "roopsnft",
        "lives": "4",
        "score": "807"
    },
    {
        "rank": "2",
        "name": "rohald",
        "lives": "7",
        "score": "766"
    },
    {
        "rank": "3",
        "name": "kyleknows_",
        "lives": "4",
        "score": "758"
    },
    {
        "rank": "4",
        "name": "itsbrb",
        "lives": "2",
        "score": "756"
    },
    {
        "rank": "5",
        "name": "maxi_cp0",
        "lives": "5",
        "score": "714"
    },
    {
        "rank": "6",
        "name": "bigcubanisland",
        "lives": "3",
        "score": "681"
    },
    {
        "rank": "7",
        "name": "blackshibawolf",
        "lives": "4",
        "score": "573"
    },
    {
        "rank": "8",
        "name": "freezz09",
        "lives": "2",
        "score": "524"
    },
    {
        "rank": "9",
        "name": "darkdegenx",
        "lives": "3",
        "score": "494"
    },
    {
        "rank": "10",
        "name": "stan0209_eth",
        "lives": "3",
        "score": "408"
    },
    {
        "rank": "11",
        "name": "ch3xican",
        "lives": "2",
        "score": "346"
    },
    {
        "rank": "12",
        "name": "_eye5_",
        "lives": "5",
        "score": "341"
    },
    {
        "rank": "13",
        "name": "tosche_",
        "lives": "3",
        "score": "292"
    },
    {
        "rank": "14",
        "name": "metabloxx",
        "lives": "2",
        "score": "280"
    },
    {
        "rank": "15",
        "name": "thelazerace",
        "lives": "3",
        "score": "265"
    },
    {
        "rank": "16",
        "name": "leathersosoft7",
        "lives": "1",
        "score": "223"
    },
    {
        "rank": "17",
        "name": "thebullishtradr",
        "lives": "6",
        "score": "218"
    },
    {
        "rank": "18",
        "name": "sivxrtx",
        "lives": "3",
        "score": "212"
    },
    {
        "rank": "19",
        "name": "hakisein",
        "lives": "1",
        "score": "172"
    },
    {
        "rank": "20",
        "name": "aapebad",
        "lives": "5",
        "score": "136"
    },
    {
        "rank": "21",
        "name": "cowboytraits",
        "lives": "5",
        "score": "115"
    },
    {
        "rank": "22",
        "name": "takarita118",
        "lives": "2",
        "score": "105"
    },
    {
        "rank": "23",
        "name": "greenie_sr",
        "lives": "5",
        "score": "38"
    },
    {
        "rank": "24",
        "name": "poppypunky",
        "lives": "4",
        "score": "30"
    },
    {
        "rank": "25",
        "name": "thebinarycoder",
        "lives": "3",
        "score": "25"
    },
    {
        "rank": "26",
        "name": "hanley_keith",
        "lives": "1",
        "score": "25"
    },
    {
        "rank": "27",
        "name": "smortyair",
        "lives": "4",
        "score": "23"
    },
    {
        "rank": "28",
        "name": "starl3xx",
        "lives": "7",
        "score": "19"
    },
    {
        "rank": "29",
        "name": "merts_eth",
        "lives": "6",
        "score": "17"
    },
    {
        "rank": "30",
        "name": "notdroll",
        "lives": "5",
        "score": "16"
    }
],
            'trollalot': [
    {
        "rank": "1",
        "name": "sumopickle",
        "lives": "6",
        "score": "833"
    },
    {
        "rank": "2",
        "name": "akamoney_eth",
        "lives": "6",
        "score": "797"
    },
    {
        "rank": "3",
        "name": "mcvault11",
        "lives": "8",
        "score": "787"
    },
    {
        "rank": "4",
        "name": "bene_bla",
        "lives": "9",
        "score": "770"
    },
    {
        "rank": "5",
        "name": "polandjim",
        "lives": "2",
        "score": "753"
    },
    {
        "rank": "6",
        "name": "wangbinfeng2",
        "lives": "3",
        "score": "746"
    },
    {
        "rank": "7",
        "name": "filippobazzoli",
        "lives": "7",
        "score": "743"
    },
    {
        "rank": "8",
        "name": "kuyamark",
        "lives": "8",
        "score": "737"
    },
    {
        "rank": "9",
        "name": "samplaysgolf",
        "lives": "4",
        "score": "719"
    },
    {
        "rank": "10",
        "name": "jasmarkangeles",
        "lives": "2",
        "score": "716"
    },
    {
        "rank": "11",
        "name": "thepeacedout",
        "lives": "3",
        "score": "688"
    },
    {
        "rank": "12",
        "name": "ste85gra",
        "lives": "2",
        "score": "673"
    },
    {
        "rank": "13",
        "name": "yulei___",
        "lives": "6",
        "score": "623"
    },
    {
        "rank": "14",
        "name": "poloman1982",
        "lives": "3",
        "score": "557"
    },
    {
        "rank": "15",
        "name": "steven34568146",
        "lives": "7",
        "score": "514"
    },
    {
        "rank": "16",
        "name": "atari_god",
        "lives": "6",
        "score": "490"
    },
    {
        "rank": "17",
        "name": "___j___w_",
        "lives": "8",
        "score": "478"
    },
    {
        "rank": "18",
        "name": "redwooddawg",
        "lives": "4",
        "score": "450"
    },
    {
        "rank": "19",
        "name": "robottiandrea",
        "lives": "1",
        "score": "418"
    },
    {
        "rank": "20",
        "name": "lakoz_",
        "lives": "7",
        "score": "391"
    },
    {
        "rank": "21",
        "name": "spacecowboycat",
        "lives": "9",
        "score": "346"
    },
    {
        "rank": "22",
        "name": "reekjpeg",
        "lives": "8",
        "score": "309"
    },
    {
        "rank": "23",
        "name": "webmixgamer",
        "lives": "1",
        "score": "268"
    },
    {
        "rank": "24",
        "name": "iamshabbazz",
        "lives": "9",
        "score": "251"
    },
    {
        "rank": "25",
        "name": "lukey___pookie",
        "lives": "1",
        "score": "249"
    },
    {
        "rank": "26",
        "name": "pauncheth",
        "lives": "7",
        "score": "238"
    },
    {
        "rank": "27",
        "name": "faresnightnft",
        "lives": "3",
        "score": "213"
    },
    {
        "rank": "28",
        "name": "8270eth",
        "lives": "6",
        "score": "207"
    },
    {
        "rank": "29",
        "name": "humpstyles",
        "lives": "2",
        "score": "203"
    },
    {
        "rank": "30",
        "name": "fiscalbits",
        "lives": "2",
        "score": "188"
    },
    {
        "rank": "31",
        "name": "fernlovescrypto",
        "lives": "8",
        "score": "177"
    },
    {
        "rank": "32",
        "name": "maybepeykal",
        "lives": "1",
        "score": "171"
    },
    {
        "rank": "33",
        "name": "barthazian",
        "lives": "2",
        "score": "151"
    },
    {
        "rank": "34",
        "name": "ksk2088394",
        "lives": "6",
        "score": "139"
    },
    {
        "rank": "35",
        "name": "minnesotahaze",
        "lives": "7",
        "score": "132"
    },
    {
        "rank": "36",
        "name": "p3te_eth",
        "lives": "6",
        "score": "128"
    },
    {
        "rank": "37",
        "name": "dgtlemissions",
        "lives": "3",
        "score": "94"
    },
    {
        "rank": "38",
        "name": "__diso",
        "lives": "3",
        "score": "73"
    },
    {
        "rank": "39",
        "name": "bibdieu",
        "lives": "8",
        "score": "57"
    },
    {
        "rank": "40",
        "name": "godbreakerbtc",
        "lives": "3",
        "score": "57"
    },
    {
        "rank": "41",
        "name": "heytedward",
        "lives": "1",
        "score": "39"
    },
    {
        "rank": "42",
        "name": "ladyapefundy",
        "lives": "6",
        "score": "39"
    },
    {
        "rank": "43",
        "name": "wendy58152",
        "lives": "5",
        "score": "35"
    },
    {
        "rank": "44",
        "name": "solarsoundwave",
        "lives": "2",
        "score": "32"
    },
    {
        "rank": "45",
        "name": "zx07353502",
        "lives": "3",
        "score": "28"
    },
    {
        "rank": "46",
        "name": "duis_eth",
        "lives": "1",
        "score": "27"
    },
    {
        "rank": "47",
        "name": "plckleap",
        "lives": "2",
        "score": "23"
    },
    {
        "rank": "48",
        "name": "bbtntwrk",
        "lives": "10",
        "score": "17"
    },
    {
        "rank": "49",
        "name": "henftee",
        "lives": "3",
        "score": "14"
    },
    {
        "rank": "50",
        "name": "drari1080",
        "lives": "4",
        "score": "14"
    },
    {
        "rank": "51",
        "name": "jj_br0ther",
        "lives": "7",
        "score": "10"
    },
    {
        "rank": "52",
        "name": "alleycatnft",
        "lives": "5",
        "score": "9"
    },
    {
        "rank": "53",
        "name": "0xamica",
        "lives": "6",
        "score": "8"
    },
    {
        "rank": "54",
        "name": "rezzonico",
        "lives": "6",
        "score": "5"
    },
    {
        "rank": "55",
        "name": "fundyape3659",
        "lives": "4",
        "score": "4"
    },
    {
        "rank": "56",
        "name": "niftymateo",
        "lives": "8",
        "score": "3"
    }
]
        };

        // Data storage
        let allData = {};
        let currentChart = null;
        const rowsPerPage = 10;
        let currentPage = 1;
        let currentTableData = [];
        let currentTableDataset = 'all';
        let searchQuery = '';

        // Store the last displayed statistics for animations
        let currentStats = {
            totalUsers: 0,
            totalScore: 0,
            totalLives: 0,
            avgScore: 0,
            maxScore: 0,
            medianScore: 0,
            zeroScores: 0
        };

        // Animation control
        let animationFrames = [];
        let updateTimeout = null;

        // Department manager mapping
        const departmentManagers = {
            'bully': 'Bully The Kid',
            'doxmuddler': 'Dox Muddler',
            'negativenancy': 'Negative Nancy',
            'trollalot': 'Sir TrollzALot'
        };

        // Manager icons mapping
        const managerIcons = {
            'bully': 'images/bully_overlord_noicon.webp',
            'doxmuddler': 'images/conspiracy_overlord_no_icon.webp',
            'negativenancy': 'images/bearish_overlord_noicon.webp',
            'trollalot': 'images/troll_overlord_no_icon.webp'
        };

        // Initialize data from inline JSON
        function loadData() {
            // Process raw data and convert strings to numbers
            for (const [dataset, data] of Object.entries(rawData)) {
                allData[dataset] = data.map(item => ({
                    ...item,
                    score: parseInt(item.score),
                    rank: parseInt(item.rank),
                    lives: parseInt(item.lives || 0),
                    departmentManager: departmentManagers[dataset]
                }));
            }

            // Initial chart render and department rankings
            updateDepartmentRankings();
            updateVisualization();
        }

        // Update department rankings card
        function updateDepartmentRankings() {
            const departmentStats = [];

            // Calculate stats for each department
            for (const [dataset, data] of Object.entries(allData)) {
                const scores = data.map(item => item.score);
                const lives = data.map(item => item.lives);
                const totalScore = scores.reduce((a, b) => a + b, 0);
                const totalLives = lives.reduce((a, b) => a + b, 0);
                const userCount = data.length;
                const avgScore = totalScore / userCount;
                const avgLives = totalLives / userCount;
                const maxScore = Math.max(...scores);
                const zeroScoreCount = scores.filter(score => score === 0).length;
                const zeroScoreEmployeesLives = data.filter(item => item.score === 0).reduce((sum, item) => sum + item.lives, 0);
                const totalLivesExcludingZeroScores = totalLives - zeroScoreEmployeesLives;
                const topUser = data.find(user => user.score === maxScore);

                departmentStats.push({
                    dataset,
                    name: departmentManagers[dataset],
                    totalScore,
                    totalLives,
                    totalLivesExcludingZeroScores,
                    userCount,
                    avgScore,
                    avgLives,
                    maxScore,
                    zeroScoreCount,
                    topUser: topUser.name,
                    icon: managerIcons[dataset]
                });
            }

            // Sort by total score (descending)
            departmentStats.sort((a, b) => b.totalScore - a.totalScore);

            // Update the UI
            const container = document.getElementById('departmentRankings');
            container.innerHTML = '';

            departmentStats.forEach((dept, index) => {
                const rank = index + 1;
                const card = document.createElement('div');
                card.className = `dept-rank-card rank-${rank}`;
                card.setAttribute('data-department', dept.dataset);

                card.innerHTML = `
                    <div class="dept-rank-number rank-${rank}">${rank}</div>
                    <div class="dept-manager-info">
                        <img src="${dept.icon}" alt="${dept.name}" class="dept-manager-icon">
                        <div>
                            <div class="font-semibold text-gray-900">${dept.name}</div>
                            <div class="text-xs text-gray-600">Top: ${dept.topUser}</div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Total Score:</span>
                            <span class="font-semibold">${dept.totalScore.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Total Lives:</span>
                            <span class="font-semibold">${dept.totalLives.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Lives (Excl. Zero):</span>
                            <span class="font-semibold">${dept.totalLivesExcludingZeroScores.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Avg Lives:</span>
                            <span class="font-semibold">${dept.avgLives.toFixed(1)}</span>
                        </div>

                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Max Score:</span>
                            <span class="font-semibold">${dept.maxScore.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Avg Score:</span>
                            <span class="font-semibold">${dept.avgScore.toFixed(1)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Zero Scores:</span>
                            <span class="font-semibold">${dept.zeroScoreCount}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Employees:</span>
                            <span class="font-semibold">${dept.userCount}</span>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Create rank distribution data (employees ranked by score)
        function createPowerLawData(data) {
            // Sort users by score in descending order
            const sortedData = [...data].sort((a, b) => b.score - a.score);

            // Create labels and scores arrays
            const labels = sortedData.map((_, index) => `Rank ${index + 1}`);
            const scores = sortedData.map(user => user.score);

            return { labels, scores, sortedData };
        }

        // Create histogram data
        function createHistogramData(data, binSize) {
            const scores = data.map(item => item.score);
            const maxScore = Math.max(...scores);
            const minScore = Math.min(...scores);

            // Create bins
            const bins = [];
            for (let i = minScore; i <= maxScore; i += binSize) {
                bins.push({
                    min: i,
                    max: i + binSize - 1,
                    count: 0,
                    label: `${i}-${i + binSize - 1}`
                });
            }

            // Count scores in each bin
            scores.forEach(score => {
                const binIndex = Math.floor((score - minScore) / binSize);
                if (bins[binIndex]) {
                    bins[binIndex].count++;
                }
            });

            return bins;
        }

        // Cancel all running animations
        function cancelAnimations() {
            animationFrames.forEach(frame => cancelAnimationFrame(frame));
            animationFrames = [];
        }

        // Animate a number from start to end
        function animateNumber(id, start, end, formatFn, duration = 300) {
            const el = document.getElementById(id);
            if (!el) return;

            // Skip animation if values are the same
            if (start === end) {
                el.textContent = formatFn(end);
                return;
            }

            const startTime = performance.now();

            function update(now) {
                const progress = Math.min((now - startTime) / duration, 1);
                const value = start + (end - start) * progress;
                el.textContent = formatFn(value);

                if (progress < 1) {
                    const frame = requestAnimationFrame(update);
                    animationFrames.push(frame);
                } else {
                    // Remove completed animation frame
                    animationFrames = animationFrames.filter(f => f !== frame);
                }
            }

            const frame = requestAnimationFrame(update);
            animationFrames.push(frame);
        }


        // Update statistics with debouncing
        function updateStats(data) {
            // Cancel any previous animations
            cancelAnimations();

            const scores = data.map(item => item.score);
            const lives = data.map(item => item.lives);
            const totalUsers = data.length;
            const totalScore = scores.reduce((a, b) => a + b, 0);
            const totalLives = lives.reduce((a, b) => a + b, 0);
            const avgScore = totalScore / totalUsers;
            const avgLives = totalLives / totalUsers;
            const maxScore = Math.max(...scores);
            const zeroScores = scores.filter(score => score === 0).length;

            // Calculate median
            const sortedScores = [...scores].sort((a, b) => a - b);
            const medianScore = sortedScores.length % 2 === 0
                ? (sortedScores[sortedScores.length / 2 - 1] + sortedScores[sortedScores.length / 2]) / 2
                : sortedScores[Math.floor(sortedScores.length / 2)];

            animateNumber('totalUsers', currentStats.totalUsers, totalUsers, v => Math.round(v).toLocaleString());
            animateNumber('totalScore', currentStats.totalScore, totalScore, v => Math.round(v).toLocaleString());
            animateNumber('totalLives', currentStats.totalLives || 0, totalLives, v => Math.round(v).toLocaleString());
            animateNumber('avgScore', currentStats.avgScore, avgScore, v => v.toFixed(1));
            animateNumber('maxScore', currentStats.maxScore, maxScore, v => Math.round(v).toLocaleString());
            animateNumber('medianScore', currentStats.medianScore, medianScore, v => Math.round(v).toLocaleString());
            animateNumber('zeroScores', currentStats.zeroScores, zeroScores, v => Math.round(v).toLocaleString());

            currentStats = {
                totalUsers,
                totalScore,
                totalLives,
                avgScore,
                maxScore,
                medianScore,
                zeroScores
            };
        }

        // Update top performers table
        function updateTopPerformers(data, selectedDataset) {
            const filteredData = data.filter(user =>
                user.name.toLowerCase().includes(searchQuery)
            );
            const sortedData = [...filteredData].sort((a, b) => b.score - a.score);

            // Calculate global ranks if "All" is selected, otherwise preserve original ranks
            let dataWithRanks;
            if (selectedDataset === 'all') {
                // Create a map of all users sorted by score to get global ranks
                const allSortedData = [...data].sort((a, b) => b.score - a.score);
                const globalRankMap = new Map();
                allSortedData.forEach((user, index) => {
                    const key = `${user.name}_${user.score}_${user.departmentManager}`;
                    globalRankMap.set(key, index + 1);
                });

                // Apply global ranks to sorted data
                dataWithRanks = sortedData.map(user => ({
                    ...user,
                    globalRank: globalRankMap.get(`${user.name}_${user.score}_${user.departmentManager}`)
                }));
            } else {
                // Use original department ranks
                dataWithRanks = sortedData;
            }

            currentTableData = dataWithRanks;
            currentTableDataset = selectedDataset;
            const totalPages = Math.max(1, Math.ceil(dataWithRanks.length / rowsPerPage));
            if (currentPage > totalPages) currentPage = totalPages;
            const startIndex = (currentPage - 1) * rowsPerPage;
            const pageData = dataWithRanks.slice(startIndex, startIndex + rowsPerPage);

            const tableBody = document.getElementById('topPerformersTable');
            tableBody.innerHTML = '';

            // Update performers icon
            const performersIconElement = document.getElementById('performersIcon');
            const datasetName = selectedDataset === 'all' ? 'All Departments' :
                (departmentManagers[selectedDataset] || selectedDataset);

            if (selectedDataset === 'all') {
                performersIconElement.innerHTML = `<img src="images/data_box_icon.png" alt="${datasetName}" class="manager-icon">`;
            } else if (managerIcons[selectedDataset]) {
                performersIconElement.innerHTML = `<img src="${managerIcons[selectedDataset]}" alt="${datasetName}" class="manager-icon">`;
            } else {
                performersIconElement.innerHTML = '';
            }

            pageData.forEach((user, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';

                const departmentManager = user.departmentManager || 'Unknown';
                const displayRank = selectedDataset === 'all' ? user.globalRank : user.rank;

                row.innerHTML = `
                    <td class="py-2 px-4">${displayRank}</td>
                    <td class="py-2 px-4 font-medium">${user.name}</td>
                    <td class="py-2 px-4">${user.score.toLocaleString()}</td>
                    <td class="py-2 px-4">${user.lives}</td>
                    <td class="py-2 px-4">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                            ${departmentManager}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Update pagination info
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

        // Update chart and visualization
        function updateVisualization() {
            const selectedDataset = document.getElementById('datasetSelect').value;
            const chartType = document.getElementById('chartType').value;
            const binSize = parseInt(document.getElementById('binSize').value || 25);

            currentPage = 1;

            // Show/hide bin size selector based on chart type
            const binSizeContainer = document.getElementById('binSizeContainer');
            binSizeContainer.style.display = chartType === 'histogram' ? 'block' : 'none';

            let data = [];
            let datasetName = '';

            if (selectedDataset === 'all') {
                // Combine all datasets
                data = Object.values(allData).flat();
                datasetName = 'All Departments';
            } else {
                data = allData[selectedDataset] || [];
                datasetName = departmentManagers[selectedDataset] ||
                    (selectedDataset.charAt(0).toUpperCase() +
                        selectedDataset.slice(1).replace('-', ' '));
            }

            if (data.length === 0) return;

            // Update chart title and description
            const chartTitle = document.getElementById('chartTitle');
            const chartDescription = document.getElementById('chartDescription');

            if (chartType === 'powerlaw') {
                chartTitle.textContent = 'Score Distribution (Rank Distribution)';
                chartDescription.textContent = 'Employees ranked by score (highest to lowest) to visualize score concentration';
            } else {
                chartTitle.textContent = 'Score Distribution Histogram';
                chartDescription.textContent = 'Distribution of employee scores across the selected department(s)';
            }

            // Update statistics
            updateStats(data);

            // Update top performers
            updateTopPerformers(data, selectedDataset);

            // Update chart
            const ctx = document.getElementById('histogramChart').getContext('2d');

            if (currentChart) {
                currentChart.destroy();
            }

            // Update histogram icon
            const histogramIconElement = document.getElementById('histogramIcon');
            if (selectedDataset === 'all') {
                histogramIconElement.innerHTML = `<img src="images/data_box_icon.png" alt="${datasetName}" class="manager-icon">`;
            } else if (managerIcons[selectedDataset]) {
                histogramIconElement.innerHTML = `<img src="${managerIcons[selectedDataset]}" alt="${datasetName}" class="manager-icon">`;
            } else {
                histogramIconElement.innerHTML = '';
            }

            if (chartType === 'powerlaw') {
                // Create power law data
                const powerLawData = createPowerLawData(data);

                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: powerLawData.labels,
                        datasets: [{
                            label: 'User Score',
                            data: powerLawData.scores,
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2,
                            fill: true,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: `Rank Distribution - ${datasetName}`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: function (context) {
                                        const index = context[0].dataIndex;
                                        const user = powerLawData.sortedData[index];
                                        return `Rank #${index + 1}: ${user.name}`;
                                    },
                                    label: function (context) {
                                        return `Score: ${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Score'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'User Rank (Highest to Lowest Score)'
                                },
                                ticks: {
                                    maxTicksLimit: 10
                                }
                            }
                        }
                    }
                });
            } else {
                // Create histogram data
                const histogramData = createHistogramData(data, binSize);

                currentChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: histogramData.map(bin => bin.label),
                        datasets: [{
                            label: 'Number of Users',
                            data: histogramData.map(bin => bin.count),
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `Score Distribution - ${datasetName}`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Users'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Score Range'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Debounced update function
        function debouncedUpdateVisualization() {
            // Cancel any pending update
            if (updateTimeout) {
                clearTimeout(updateTimeout);
            }

            // Schedule new update
            updateTimeout = setTimeout(() => {
                updateVisualization();
                updateTimeout = null;
            }, 50);
        }

        // Event listeners with debouncing
        document.getElementById('datasetSelect').addEventListener('change', debouncedUpdateVisualization);
        document.getElementById('chartType').addEventListener('change', updateVisualization);
        document.getElementById('binSize').addEventListener('change', updateVisualization);
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                updateTopPerformers(currentTableData, currentTableDataset);
            }
        });
        document.getElementById('nextPage').addEventListener('click', () => {
            const totalPages = Math.max(1, Math.ceil(currentTableData.length / rowsPerPage));
            if (currentPage < totalPages) {
                currentPage++;
                updateTopPerformers(currentTableData, currentTableDataset);
            }
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            currentPage = 1;
            const selectedDataset = document.getElementById('datasetSelect').value;
            let data = [];
            if (selectedDataset === 'all') {
                data = Object.values(allData).flat();
            } else {
                data = allData[selectedDataset] || [];
            }
            updateTopPerformers(data, selectedDataset);
        });

        // Initialize
        loadData();
    </script>
</body>

</html>