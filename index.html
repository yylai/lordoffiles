<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lord of Files - Score Distribution Visualization</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        /* Custom CSS inspired by shadcn/ui */
        .card {
            background: white;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .card-header {
            padding: 1.5rem 1.5rem 0 1.5rem;
        }

        .card-content {
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 1.25;
            color: #111827;
        }

        .card-description {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        .button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
            border: none;
            padding: 0.5rem 1rem;
        }

        .button-primary {
            background-color: #3b82f6;
            color: white;
        }

        .button-primary:hover {
            background-color: #2563eb;
        }

        .button-secondary {
            background-color: #f9fafb;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .button-secondary:hover {
            background-color: #f3f4f6;
        }

        .select {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            background: white;
            min-width: 180px;
        }

        .select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #111827;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        /* Manager icons */
        .manager-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 12px;
        }

        /* Background overlay to reduce contrast */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('images/Doodles_background_01 2.jpg');
            background-size: cover;
            background-position: center;
            opacity: 0.2;
            z-index: -1;
        }

        /* Department ranking cards */
        .dept-rank-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }

        .dept-rank-card.rank-1 {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fef3c7 0%, #ffffff 100%);
        }

        .dept-rank-card.rank-2 {
            border-color: #9ca3af;
            background: linear-gradient(135deg, #f3f4f6 0%, #ffffff 100%);
        }

        .dept-rank-card.rank-3 {
            border-color: #d97706;
            background: linear-gradient(135deg, #fed7aa 0%, #ffffff 100%);
        }

        .dept-rank-card[data-department="bully"] {
            background: rgba(129, 134, 94, 0.2);
            border-color: rgba(129, 134, 94, 0.5);
        }

        .dept-rank-card[data-department="doxmuddler"] {
            background: rgba(95, 97, 135, 0.2);
            border-color: rgba(95, 97, 135, 0.5);
        }

        .dept-rank-card[data-department="negativenancy"] {
            background: rgba(127, 96, 134, 0.2);
            border-color: rgba(127, 96, 134, 0.5);
        }

        .dept-rank-card[data-department="trollalot"] {
            background: rgba(136, 96, 96, 0.2);
            border-color: rgba(136, 96, 96, 0.5);
        }

        .dept-rank-card[data-department="bully"] .dept-rank-number {
            background-color: rgb(129, 134, 94);
            color: white;
        }

        .dept-rank-card[data-department="doxmuddler"] .dept-rank-number {
            background-color: rgb(95, 97, 135);
            color: white;
        }

        .dept-rank-card[data-department="negativenancy"] .dept-rank-number {
            background-color: rgb(127, 96, 134);
            color: white;
        }

        .dept-rank-card[data-department="trollalot"] .dept-rank-number {
            background-color: rgb(136, 96, 96);
            color: white;
        }

        .dept-rank-number {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.875rem;
        }

        .dept-rank-number.rank-1 {
            background-color: #fbbf24;
            color: white;
        }

        .dept-rank-number.rank-2 {
            background-color: #9ca3af;
            color: white;
        }

        .dept-rank-number.rank-3 {
            background-color: #d97706;
            color: white;
        }

        .dept-rank-number.rank-4 {
            background-color: #6b7280;
            color: white;
        }

        .dept-manager-info {
            display: flex;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .dept-manager-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 0.75rem;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="mb-8">
            <h1 class="text-4xl font-bold text-gray-900 mb-2">
                <a href="https://lordofthefiles.xyz/" target="_blank" rel="noopener noreferrer"
                    class="hover:text-blue-600 transition-colors">Lord of Files Analytics</a>
                <a href="#disclaimer" class="text-xs text-gray-500 ml-2 hover:text-gray-700 underline">(data
                    disclaimer)</a>
            </h1>
            <p class="text-gray-600">Visualize and analyze score distributions across different departments</p>
            <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-700">
                    ðŸ“Š All data presented in this dashboard is a snapshot on June 6th, 2025 at 10:05PM PDT.
                </p>
            </div>
        </div>

        <div class="mb-6 flex flex-wrap gap-4 items-center">
            <div>
                <label for="datasetSelect" class="block text-sm font-medium text-gray-700 mb-2">Select Manager:</label>
                <select id="datasetSelect" class="select">
                    <option value="all">All</option>
                    <option value="bully">Bully The Kid</option>
                    <option value="doxmuddler">Dox Muddler</option>
                    <option value="negativenancy">Negative Nancy</option>
                    <option value="trollalot">Sir TrollzALot</option>
                </select>
            </div>

            <div>
                <label for="chartType" class="block text-sm font-medium text-gray-700 mb-2">Chart Type:</label>
                <select id="chartType" class="select">
                    <option value="powerlaw">Rank Distribution</option>
                    <option value="histogram">Score Histogram</option>
                </select>
            </div>

            <div id="binSizeContainer" style="display: none;">
                <label for="binSize" class="block text-sm font-medium text-gray-700 mb-2">Bin Size:</label>
                <select id="binSize" class="select">
                    <option value="1">1 point</option>
                    <option value="10">10 points</option>
                    <option value="25" selected>25 points</option>
                    <option value="50">50 points</option>
                    <option value="100">100 points</option>
                </select>
            </div>


        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">-</div>
                <div class="stat-label">Total Users</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalScore">-</div>
                <div class="stat-label">Total Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="maxScore">-</div>
                <div class="stat-label">Max Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="medianScore">-</div>
                <div class="stat-label">Median Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgScore">-</div>
                <div class="stat-label">Average Score</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="zeroScores">-</div>
                <div class="stat-label">Zero Scores</div>
            </div>
        </div>

        <!-- Department Rankings Card -->
        <div class="card mt-8">
            <div class="card-header">
                <h2 class="card-title">Department Rankings</h2>
                <p class="card-description">Total scores and performance ranking by department manager</p>
            </div>
            <div class="card-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="departmentRankings">
                    <!-- Department ranking cards will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="card mt-8">
            <div class="card-header">
                <h2 class="card-title flex items-center">
                    <span id="performersIcon" class="mr-3"></span>
                    <span>Top Performers</span>
                </h2>
                <p class="card-description">Users with the highest scores in the selected department</p>
            </div>
            <div class="card-content">
                <div class="flex justify-end mb-2">
                    <input id="searchInput" type="text" placeholder="Search by name" class="select" />
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Rank</th>
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Name</th>
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Score</th>
                                <th class="text-left py-2 px-4 font-medium text-gray-900">Department Manager</th>
                            </tr>
                        </thead>
                        <tbody id="topPerformersTable">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="flex items-center justify-between mt-4">
                    <button id="prevPage" class="button button-secondary">Previous</button>
                    <span id="pageInfo" class="text-sm text-gray-600"></span>
                    <button id="nextPage" class="button button-secondary">Next</button>
                </div>
            </div>
        </div>

        <!-- Chart Card -->
        <div class="card mt-8">
            <div class="card-header">
                <h2 class="card-title flex items-center">
                    <span id="histogramIcon" class="mr-3"></span>
                    <span id="chartTitle">Score Distribution (Power Law Analysis)</span>
                </h2>
                <p id="chartDescription" class="card-description">Users ranked by score (highest to lowest) to visualize
                    power law distribution</p>
            </div>
            <div class="card-content">
                <div style="position: relative; height: 400px;">
                    <canvas id="histogramChart"></canvas>
                </div>
            </div>
        </div>



        <!-- Disclaimer -->
        <div id="disclaimer" class="mt-16 p-6 bg-gray-100 border-t border-gray-200">
            <div class="text-center">
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Data Disclaimer</h3>
                <p class="text-sm text-gray-600">
                    All data presented in this dashboard is as of June 6th, 2025 at 10:05PM PDT.
                    <br>
                    This information represents a snapshot in time and may not reflect current standings.
                    <br><br>
                    This program calculates statistics and visualizations to the best of its ability but makes no
                    guarantees on the accuracy of the results.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Inline JSON data
        const rawData = {
            'bully': [
                {
                    "rank": "1",
                    "name": "streetervilled1",
                    "score": "404"
                },
                {
                    "rank": "2",
                    "name": "geist254",
                    "score": "393"
                },
                {
                    "rank": "3",
                    "name": "jivedoodle",
                    "score": "387"
                },
                {
                    "rank": "4",
                    "name": "james_polhill",
                    "score": "383"
                },
                {
                    "rank": "5",
                    "name": "oliver13h",
                    "score": "377"
                },
                {
                    "rank": "6",
                    "name": "0nelinewonder",
                    "score": "373"
                },
                {
                    "rank": "7",
                    "name": "tasty_snackz",
                    "score": "372"
                },
                {
                    "rank": "8",
                    "name": "santandood",
                    "score": "359"
                },
                {
                    "rank": "9",
                    "name": "moonshotkongz",
                    "score": "356"
                },
                {
                    "rank": "10",
                    "name": "soybienmamon",
                    "score": "351"
                },
                {
                    "rank": "11",
                    "name": "kayshhhmo",
                    "score": "349"
                },
                {
                    "rank": "12",
                    "name": "the_waco_kid1",
                    "score": "345"
                },
                {
                    "rank": "13",
                    "name": "mace1337ftw",
                    "score": "343"
                },
                {
                    "rank": "14",
                    "name": "0xbjartek",
                    "score": "338"
                },
                {
                    "rank": "15",
                    "name": "ryrotaco",
                    "score": "335"
                },
                {
                    "rank": "16",
                    "name": "doodcollects",
                    "score": "329"
                },
                {
                    "rank": "17",
                    "name": "bitrise25",
                    "score": "325"
                },
                {
                    "rank": "18",
                    "name": "cociboni",
                    "score": "324"
                },
                {
                    "rank": "19",
                    "name": "skeens_jeremy",
                    "score": "323"
                },
                {
                    "rank": "20",
                    "name": "doubtmeharder",
                    "score": "313"
                },
                {
                    "rank": "21",
                    "name": "montiweb3",
                    "score": "312"
                },
                {
                    "rank": "22",
                    "name": "km404atl",
                    "score": "297"
                },
                {
                    "rank": "23",
                    "name": "make_ithappenn",
                    "score": "285"
                },
                {
                    "rank": "24",
                    "name": "nrd_design",
                    "score": "279"
                },
                {
                    "rank": "25",
                    "name": "petranto12",
                    "score": "264"
                },
                {
                    "rank": "26",
                    "name": "outsidethe0x",
                    "score": "251"
                },
                {
                    "rank": "27",
                    "name": "skr_ventures",
                    "score": "220"
                },
                {
                    "rank": "28",
                    "name": "digikelly",
                    "score": "214"
                },
                {
                    "rank": "29",
                    "name": "thenftshack",
                    "score": "204"
                },
                {
                    "rank": "30",
                    "name": "vonfrontin",
                    "score": "204"
                },
                {
                    "rank": "31",
                    "name": "tonoboon",
                    "score": "189"
                },
                {
                    "rank": "32",
                    "name": "ericdzengeleski",
                    "score": "181"
                },
                {
                    "rank": "33",
                    "name": "mrcookiesnft",
                    "score": "172"
                },
                {
                    "rank": "34",
                    "name": "bigdaddyerac",
                    "score": "168"
                },
                {
                    "rank": "35",
                    "name": "tappi365",
                    "score": "158"
                },
                {
                    "rank": "36",
                    "name": "happy_dood_",
                    "score": "154"
                },
                {
                    "rank": "37",
                    "name": "hazy_purps",
                    "score": "146"
                },
                {
                    "rank": "38",
                    "name": "dingo522left",
                    "score": "135"
                },
                {
                    "rank": "39",
                    "name": "jfitz_21",
                    "score": "134"
                },
                {
                    "rank": "40",
                    "name": "ohtobisan",
                    "score": "131"
                },
                {
                    "rank": "41",
                    "name": "in2nfts",
                    "score": "131"
                },
                {
                    "rank": "42",
                    "name": "squ1nch",
                    "score": "93"
                },
                {
                    "rank": "43",
                    "name": "supermoooooo1",
                    "score": "91"
                },
                {
                    "rank": "44",
                    "name": "conquant",
                    "score": "77"
                },
                {
                    "rank": "45",
                    "name": "troyapeman",
                    "score": "65"
                },
                {
                    "rank": "46",
                    "name": "aleon523",
                    "score": "64"
                },
                {
                    "rank": "47",
                    "name": "spacecowboy2300",
                    "score": "56"
                },
                {
                    "rank": "48",
                    "name": "yankun811203",
                    "score": "54"
                },
                {
                    "rank": "49",
                    "name": "tungweb3",
                    "score": "43"
                },
                {
                    "rank": "50",
                    "name": "yuehfengmon",
                    "score": "39"
                },
                {
                    "rank": "51",
                    "name": "mr_meridian",
                    "score": "28"
                },
                {
                    "rank": "52",
                    "name": "ginsu_eth",
                    "score": "21"
                },
                {
                    "rank": "53",
                    "name": "chouyenchun1",
                    "score": "20"
                },
                {
                    "rank": "54",
                    "name": "0xjunkim",
                    "score": "17"
                },
                {
                    "rank": "55",
                    "name": "dreamcar_coin",
                    "score": "10"
                },
                {
                    "rank": "56",
                    "name": "beecass_93",
                    "score": "7"
                },
                {
                    "rank": "57",
                    "name": "0xfbm",
                    "score": "4"
                },
                {
                    "rank": "58",
                    "name": "ryanhendler1",
                    "score": "0"
                },
                {
                    "rank": "59",
                    "name": "nfungiblemotion",
                    "score": "0"
                },
                {
                    "rank": "60",
                    "name": "mriteeth",
                    "score": "0"
                },
                {
                    "rank": "61",
                    "name": "majimeqqq",
                    "score": "0"
                },
                {
                    "rank": "62",
                    "name": "lordoftheidiot5",
                    "score": "0"
                },
                {
                    "rank": "63",
                    "name": "atownbrown",
                    "score": "0"
                },
                {
                    "rank": "64",
                    "name": "small__arms",
                    "score": "0"
                },
                {
                    "rank": "65",
                    "name": "ManuismeNguyen",
                    "score": "0"
                },
                {
                    "rank": "66",
                    "name": "oklepatzky",
                    "score": "0"
                },
                {
                    "rank": "67",
                    "name": "datho09",
                    "score": "0"
                },
                {
                    "rank": "68",
                    "name": "Intyxfgt",
                    "score": "0"
                },
                {
                    "rank": "69",
                    "name": "maomin_9526",
                    "score": "0"
                },
                {
                    "rank": "70",
                    "name": "7dubs",
                    "score": "0"
                },
                {
                    "rank": "71",
                    "name": "riotact_",
                    "score": "0"
                },
                {
                    "rank": "72",
                    "name": "g01dy49",
                    "score": "0"
                },
                {
                    "rank": "73",
                    "name": "farindet29clone",
                    "score": "0"
                },
                {
                    "rank": "74",
                    "name": "credzilla",
                    "score": "0"
                },
                {
                    "rank": "75",
                    "name": "shuttergod",
                    "score": "0"
                },
                {
                    "rank": "76",
                    "name": "wingnnit",
                    "score": "0"
                },
                {
                    "rank": "77",
                    "name": "@OlabanjiOlalek2",
                    "score": "0"
                },
                {
                    "rank": "78",
                    "name": "wotwibot",
                    "score": "0"
                },
                {
                    "rank": "79",
                    "name": "sushentalwar",
                    "score": "0"
                },
                {
                    "rank": "80",
                    "name": "favoriteloner",
                    "score": "0"
                },
                {
                    "rank": "81",
                    "name": "densesyntax",
                    "score": "0"
                },
                {
                    "rank": "82",
                    "name": "dbrightnat",
                    "score": "0"
                },
                {
                    "rank": "83",
                    "name": "niftydudes",
                    "score": "0"
                },
                {
                    "rank": "84",
                    "name": "canito_eth",
                    "score": "0"
                },
                {
                    "rank": "85",
                    "name": "vmaldonadoc204",
                    "score": "0"
                }
            ],
            'doxmuddler': [
                {
                    "rank": "1",
                    "name": "vanglog_eth",
                    "score": "416"
                },
                {
                    "rank": "2",
                    "name": "akiianurinmokz1",
                    "score": "403"
                },
                {
                    "rank": "3",
                    "name": "ornimusmaximus",
                    "score": "402"
                },
                {
                    "rank": "4",
                    "name": "ippy_world",
                    "score": "397"
                },
                {
                    "rank": "5",
                    "name": "fakukam",
                    "score": "395"
                },
                {
                    "rank": "6",
                    "name": "dswagg_dmurph15",
                    "score": "392"
                },
                {
                    "rank": "7",
                    "name": "stack_marketer",
                    "score": "388"
                },
                {
                    "rank": "8",
                    "name": "jusomagi",
                    "score": "388"
                },
                {
                    "rank": "9",
                    "name": "spenc3eth",
                    "score": "386"
                },
                {
                    "rank": "10",
                    "name": "billybadass_eth",
                    "score": "386"
                },
                {
                    "rank": "11",
                    "name": "nftimot",
                    "score": "384"
                },
                {
                    "rank": "12",
                    "name": "tjc345",
                    "score": "380"
                },
                {
                    "rank": "13",
                    "name": "maycl93300",
                    "score": "375"
                },
                {
                    "rank": "14",
                    "name": "0xed9",
                    "score": "372"
                },
                {
                    "rank": "15",
                    "name": "semage_",
                    "score": "371"
                },
                {
                    "rank": "16",
                    "name": "thorlinck",
                    "score": "359"
                },
                {
                    "rank": "17",
                    "name": "jangdoocheon",
                    "score": "358"
                },
                {
                    "rank": "18",
                    "name": "heyitsellebee",
                    "score": "357"
                },
                {
                    "rank": "19",
                    "name": "0xringond",
                    "score": "355"
                },
                {
                    "rank": "20",
                    "name": "jmrock4700",
                    "score": "351"
                },
                {
                    "rank": "21",
                    "name": "ssano122",
                    "score": "351"
                },
                {
                    "rank": "22",
                    "name": "methodsnft",
                    "score": "350"
                },
                {
                    "rank": "23",
                    "name": "twixcashew",
                    "score": "339"
                },
                {
                    "rank": "24",
                    "name": "taekwonkrypto",
                    "score": "337"
                },
                {
                    "rank": "25",
                    "name": "jmraymonds",
                    "score": "329"
                },
                {
                    "rank": "26",
                    "name": "thestevenwarner",
                    "score": "328"
                },
                {
                    "rank": "27",
                    "name": "doodle2713",
                    "score": "325"
                },
                {
                    "rank": "28",
                    "name": "wetlensphotos",
                    "score": "304"
                },
                {
                    "rank": "29",
                    "name": "haroldr86",
                    "score": "302"
                },
                {
                    "rank": "30",
                    "name": "realfuple",
                    "score": "295"
                },
                {
                    "rank": "31",
                    "name": "artdoodart",
                    "score": "282"
                },
                {
                    "rank": "32",
                    "name": "iksvitzer",
                    "score": "282"
                },
                {
                    "rank": "33",
                    "name": "pequelord",
                    "score": "274"
                },
                {
                    "rank": "34",
                    "name": "john_acw",
                    "score": "272"
                },
                {
                    "rank": "35",
                    "name": "jordan81668033",
                    "score": "270"
                },
                {
                    "rank": "36",
                    "name": "_smx3_",
                    "score": "257"
                },
                {
                    "rank": "37",
                    "name": "wintek_nft",
                    "score": "257"
                },
                {
                    "rank": "38",
                    "name": "0x630_",
                    "score": "236"
                },
                {
                    "rank": "39",
                    "name": "paulomcg_",
                    "score": "226"
                },
                {
                    "rank": "40",
                    "name": "troup__",
                    "score": "224"
                },
                {
                    "rank": "41",
                    "name": "winterpopx",
                    "score": "222"
                },
                {
                    "rank": "42",
                    "name": "jawrrwiii",
                    "score": "220"
                },
                {
                    "rank": "43",
                    "name": "csiixty",
                    "score": "202"
                },
                {
                    "rank": "44",
                    "name": "maxie_abs",
                    "score": "187"
                },
                {
                    "rank": "45",
                    "name": "darkart",
                    "score": "185"
                },
                {
                    "rank": "46",
                    "name": "doodlifts",
                    "score": "172"
                },
                {
                    "rank": "47",
                    "name": "porochun",
                    "score": "167"
                },
                {
                    "rank": "48",
                    "name": "zosoiv1971",
                    "score": "154"
                },
                {
                    "rank": "49",
                    "name": "jamesgr84741652",
                    "score": "146"
                },
                {
                    "rank": "50",
                    "name": "abwasabi",
                    "score": "135"
                },
                {
                    "rank": "51",
                    "name": "jerrymeng1799",
                    "score": "109"
                },
                {
                    "rank": "52",
                    "name": "zach_engel98",
                    "score": "99"
                },
                {
                    "rank": "53",
                    "name": "metamonster7777",
                    "score": "95"
                },
                {
                    "rank": "54",
                    "name": "ricardodezoete",
                    "score": "86"
                },
                {
                    "rank": "55",
                    "name": "dakaiboy",
                    "score": "82"
                },
                {
                    "rank": "56",
                    "name": "aashmehtamusic",
                    "score": "81"
                },
                {
                    "rank": "57",
                    "name": "sullyschwartz",
                    "score": "81"
                },
                {
                    "rank": "58",
                    "name": "jpnspy",
                    "score": "68"
                },
                {
                    "rank": "59",
                    "name": "chefbaycurry",
                    "score": "65"
                },
                {
                    "rank": "60",
                    "name": "ilendrick",
                    "score": "57"
                },
                {
                    "rank": "61",
                    "name": "cryptot90",
                    "score": "57"
                },
                {
                    "rank": "62",
                    "name": "snowi_snowi",
                    "score": "55"
                },
                {
                    "rank": "63",
                    "name": "fr3nchl0af",
                    "score": "50"
                },
                {
                    "rank": "64",
                    "name": "dr_t1313",
                    "score": "46"
                },
                {
                    "rank": "65",
                    "name": "stixhq",
                    "score": "41"
                },
                {
                    "rank": "66",
                    "name": "shadab21x",
                    "score": "40"
                },
                {
                    "rank": "67",
                    "name": "0xfired",
                    "score": "32"
                },
                {
                    "rank": "68",
                    "name": "chiapudding000",
                    "score": "28"
                },
                {
                    "rank": "69",
                    "name": "bigbullye",
                    "score": "22"
                },
                {
                    "rank": "70",
                    "name": "0xneskaw",
                    "score": "21"
                },
                {
                    "rank": "71",
                    "name": "waaaaaaaaccky",
                    "score": "21"
                },
                {
                    "rank": "72",
                    "name": "breakwox",
                    "score": "17"
                },
                {
                    "rank": "73",
                    "name": "iketheturtle",
                    "score": "17"
                },
                {
                    "rank": "74",
                    "name": "beflean",
                    "score": "16"
                },
                {
                    "rank": "75",
                    "name": "gemg325",
                    "score": "16"
                },
                {
                    "rank": "76",
                    "name": "jamaalism",
                    "score": "9"
                },
                {
                    "rank": "77",
                    "name": "unkletio",
                    "score": "8"
                },
                {
                    "rank": "78",
                    "name": "mohammadha3764",
                    "score": "6"
                },
                {
                    "rank": "79",
                    "name": "wooooote",
                    "score": "4"
                },
                {
                    "rank": "80",
                    "name": "adilhooda",
                    "score": "0"
                },
                {
                    "rank": "81",
                    "name": "hettiecuttie",
                    "score": "0"
                },
                {
                    "rank": "82",
                    "name": "marv_sun",
                    "score": "0"
                },
                {
                    "rank": "83",
                    "name": "suv4301",
                    "score": "0"
                },
                {
                    "rank": "84",
                    "name": "halodave12",
                    "score": "0"
                },
                {
                    "rank": "85",
                    "name": "kriboidn",
                    "score": "0"
                },
                {
                    "rank": "86",
                    "name": "0nefern",
                    "score": "0"
                },
                {
                    "rank": "87",
                    "name": "kimchisquid",
                    "score": "0"
                },
                {
                    "rank": "88",
                    "name": "riinitaa",
                    "score": "0"
                },
                {
                    "rank": "89",
                    "name": "sumhong1015",
                    "score": "0"
                },
                {
                    "rank": "90",
                    "name": "kadaramada60284",
                    "score": "0"
                },
                {
                    "rank": "91",
                    "name": "eryckmob",
                    "score": "0"
                },
                {
                    "rank": "92",
                    "name": "waaea12",
                    "score": "0"
                },
                {
                    "rank": "93",
                    "name": "micahonchain",
                    "score": "0"
                },
                {
                    "rank": "94",
                    "name": "skylarmays4",
                    "score": "0"
                },
                {
                    "rank": "95",
                    "name": "epdrabbit",
                    "score": "0"
                },
                {
                    "rank": "96",
                    "name": "@Crumpet_Eth",
                    "score": "0"
                },
                {
                    "rank": "97",
                    "name": "jnbf666",
                    "score": "0"
                },
                {
                    "rank": "98",
                    "name": "marachadz",
                    "score": "0"
                },
                {
                    "rank": "99",
                    "name": "alexmdc",
                    "score": "0"
                },
                {
                    "rank": "100",
                    "name": "djdezree1",
                    "score": "0"
                },
                {
                    "rank": "101",
                    "name": "theog_general",
                    "score": "0"
                },
                {
                    "rank": "102",
                    "name": "atom_157",
                    "score": "0"
                },
                {
                    "rank": "103",
                    "name": "enomiseno",
                    "score": "0"
                },
                {
                    "rank": "104",
                    "name": "shiro_kishibe",
                    "score": "0"
                },
                {
                    "rank": "105",
                    "name": "titomuhammadhs",
                    "score": "0"
                },
                {
                    "rank": "106",
                    "name": "fattigertv1",
                    "score": "0"
                },
                {
                    "rank": "107",
                    "name": "fbazili",
                    "score": "0"
                },
                {
                    "rank": "108",
                    "name": "cryptohunties",
                    "score": "0"
                },
                {
                    "rank": "109",
                    "name": "@coinbilly_",
                    "score": "0"
                },
                {
                    "rank": "110",
                    "name": "g_r_o_k_a_i",
                    "score": "0"
                },
                {
                    "rank": "111",
                    "name": "jtsong2",
                    "score": "0"
                },
                {
                    "rank": "112",
                    "name": "mohamme52092916",
                    "score": "0"
                },
                {
                    "rank": "113",
                    "name": "@salimteymouri",
                    "score": "0"
                },
                {
                    "rank": "114",
                    "name": "phillfarrugia",
                    "score": "0"
                },
                {
                    "rank": "115",
                    "name": "fanisboudou",
                    "score": "0"
                },
                {
                    "rank": "116",
                    "name": "chrissi_eth",
                    "score": "0"
                },
                {
                    "rank": "117",
                    "name": "clairebear_1437",
                    "score": "0"
                },
                {
                    "rank": "118",
                    "name": "vuralyalim",
                    "score": "0"
                },
                {
                    "rank": "119",
                    "name": "stiffsol",
                    "score": "0"
                },
                {
                    "rank": "120",
                    "name": "seanli27686",
                    "score": "0"
                }
            ],
            'negativenancy': [
                {
                    "rank": "1",
                    "name": "kyleknows_",
                    "score": "408"
                },
                {
                    "rank": "2",
                    "name": "utsukushisora",
                    "score": "407"
                },
                {
                    "rank": "3",
                    "name": "p1nkcybertruck",
                    "score": "390"
                },
                {
                    "rank": "4",
                    "name": "shiba_king1991",
                    "score": "382"
                },
                {
                    "rank": "5",
                    "name": "stan0209_eth",
                    "score": "375"
                },
                {
                    "rank": "6",
                    "name": "cryptonoob221",
                    "score": "373"
                },
                {
                    "rank": "7",
                    "name": "freezz09",
                    "score": "368"
                },
                {
                    "rank": "8",
                    "name": "clevermoments",
                    "score": "364"
                },
                {
                    "rank": "9",
                    "name": "roopsnft",
                    "score": "362"
                },
                {
                    "rank": "10",
                    "name": "itsbrb",
                    "score": "358"
                },
                {
                    "rank": "11",
                    "name": "anthonycartoons",
                    "score": "357"
                },
                {
                    "rank": "12",
                    "name": "rohald",
                    "score": "356"
                },
                {
                    "rank": "13",
                    "name": "etothek_",
                    "score": "354"
                },
                {
                    "rank": "14",
                    "name": "roybotmfer",
                    "score": "345"
                },
                {
                    "rank": "15",
                    "name": "maxi_cp0",
                    "score": "338"
                },
                {
                    "rank": "16",
                    "name": "darkdegenx",
                    "score": "337"
                },
                {
                    "rank": "17",
                    "name": "ausbro80",
                    "score": "337"
                },
                {
                    "rank": "18",
                    "name": "blackshibawolf",
                    "score": "330"
                },
                {
                    "rank": "19",
                    "name": "cageranch",
                    "score": "322"
                },
                {
                    "rank": "20",
                    "name": "xoraverse",
                    "score": "311"
                },
                {
                    "rank": "21",
                    "name": "namebran40",
                    "score": "304"
                },
                {
                    "rank": "22",
                    "name": "bigcubanisland",
                    "score": "298"
                },
                {
                    "rank": "23",
                    "name": "tosche_",
                    "score": "292"
                },
                {
                    "rank": "24",
                    "name": "josemig59413139",
                    "score": "291"
                },
                {
                    "rank": "25",
                    "name": "0xstreeder",
                    "score": "288"
                },
                {
                    "rank": "26",
                    "name": "cryptokingf1",
                    "score": "287"
                },
                {
                    "rank": "27",
                    "name": "ch3xican",
                    "score": "276"
                },
                {
                    "rank": "28",
                    "name": "wenlambocandle",
                    "score": "274"
                },
                {
                    "rank": "29",
                    "name": "metabloxx",
                    "score": "269"
                },
                {
                    "rank": "30",
                    "name": "805jdub",
                    "score": "256"
                },
                {
                    "rank": "31",
                    "name": "thelazerace",
                    "score": "225"
                },
                {
                    "rank": "32",
                    "name": "sivxrtx",
                    "score": "212"
                },
                {
                    "rank": "33",
                    "name": "thebullishtradr",
                    "score": "202"
                },
                {
                    "rank": "34",
                    "name": "leathersosoft7",
                    "score": "192"
                },
                {
                    "rank": "35",
                    "name": "silentmodedm",
                    "score": "187"
                },
                {
                    "rank": "36",
                    "name": "deryaart_",
                    "score": "184"
                },
                {
                    "rank": "37",
                    "name": "ruliz_gonzalez",
                    "score": "182"
                },
                {
                    "rank": "38",
                    "name": "hakisein",
                    "score": "172"
                },
                {
                    "rank": "39",
                    "name": "_twigzzz",
                    "score": "151"
                },
                {
                    "rank": "40",
                    "name": "l_u_c_e_e_d",
                    "score": "145"
                },
                {
                    "rank": "41",
                    "name": "kky0699",
                    "score": "143"
                },
                {
                    "rank": "42",
                    "name": "aapebad",
                    "score": "136"
                },
                {
                    "rank": "43",
                    "name": "0xpsyched",
                    "score": "117"
                },
                {
                    "rank": "44",
                    "name": "cowboytraits",
                    "score": "115"
                },
                {
                    "rank": "45",
                    "name": "k_sideri",
                    "score": "109"
                },
                {
                    "rank": "46",
                    "name": "takarita118",
                    "score": "105"
                },
                {
                    "rank": "47",
                    "name": "duemers_",
                    "score": "101"
                },
                {
                    "rank": "48",
                    "name": "empty_labs",
                    "score": "60"
                },
                {
                    "rank": "49",
                    "name": "vilkhur",
                    "score": "59"
                },
                {
                    "rank": "50",
                    "name": "humahumami",
                    "score": "59"
                },
                {
                    "rank": "51",
                    "name": "ogzgzynftholder",
                    "score": "54"
                },
                {
                    "rank": "52",
                    "name": "logdefi",
                    "score": "43"
                },
                {
                    "rank": "53",
                    "name": "albertergart",
                    "score": "42"
                },
                {
                    "rank": "54",
                    "name": "eepylabs",
                    "score": "42"
                },
                {
                    "rank": "55",
                    "name": "chrishu40576020",
                    "score": "40"
                },
                {
                    "rank": "56",
                    "name": "greenie_sr",
                    "score": "38"
                },
                {
                    "rank": "57",
                    "name": "zkpawky",
                    "score": "34"
                },
                {
                    "rank": "58",
                    "name": "poppypunky",
                    "score": "30"
                },
                {
                    "rank": "59",
                    "name": "papinono_nft",
                    "score": "26"
                },
                {
                    "rank": "60",
                    "name": "hanley_keith",
                    "score": "25"
                },
                {
                    "rank": "61",
                    "name": "thebinarycoder",
                    "score": "25"
                },
                {
                    "rank": "62",
                    "name": "optipunkone",
                    "score": "24"
                },
                {
                    "rank": "63",
                    "name": "smortyair",
                    "score": "23"
                },
                {
                    "rank": "64",
                    "name": "merts_eth",
                    "score": "17"
                },
                {
                    "rank": "65",
                    "name": "notdroll",
                    "score": "16"
                },
                {
                    "rank": "66",
                    "name": "0xkhazar",
                    "score": "9"
                },
                {
                    "rank": "67",
                    "name": "starl3xx",
                    "score": "7"
                },
                {
                    "rank": "68",
                    "name": "brownthom",
                    "score": "2"
                },
                {
                    "rank": "69",
                    "name": "pitbul13",
                    "score": "1"
                },
                {
                    "rank": "70",
                    "name": "leo84117780",
                    "score": "0"
                },
                {
                    "rank": "71",
                    "name": "ethantheghoul",
                    "score": "0"
                },
                {
                    "rank": "72",
                    "name": "0xphoenixinvest",
                    "score": "0"
                },
                {
                    "rank": "73",
                    "name": "mahmoud07766",
                    "score": "0"
                },
                {
                    "rank": "74",
                    "name": "dobaethdoba",
                    "score": "0"
                },
                {
                    "rank": "75",
                    "name": "kish_t_a",
                    "score": "0"
                },
                {
                    "rank": "76",
                    "name": "fastclick__",
                    "score": "0"
                },
                {
                    "rank": "77",
                    "name": "whunder_eth",
                    "score": "0"
                },
                {
                    "rank": "78",
                    "name": "xu_bai54328",
                    "score": "0"
                },
                {
                    "rank": "79",
                    "name": "jazzpill_",
                    "score": "0"
                },
                {
                    "rank": "80",
                    "name": "tamnhaneth",
                    "score": "0"
                },
                {
                    "rank": "81",
                    "name": "sweetlikesaul",
                    "score": "0"
                },
                {
                    "rank": "82",
                    "name": "justrecess_",
                    "score": "0"
                },
                {
                    "rank": "83",
                    "name": "falconz_eth",
                    "score": "0"
                },
                {
                    "rank": "84",
                    "name": "alpurrt_",
                    "score": "0"
                },
                {
                    "rank": "85",
                    "name": "domefunai",
                    "score": "0"
                },
                {
                    "rank": "86",
                    "name": "sebastien_xyz",
                    "score": "0"
                },
                {
                    "rank": "87",
                    "name": "itsthe90sagain",
                    "score": "0"
                },
                {
                    "rank": "88",
                    "name": "theprmpl",
                    "score": "0"
                },
                {
                    "rank": "89",
                    "name": "juuukaaay",
                    "score": "0"
                },
                {
                    "rank": "90",
                    "name": "baycgel",
                    "score": "0"
                },
                {
                    "rank": "91",
                    "name": "0xpetty",
                    "score": "0"
                },
                {
                    "rank": "92",
                    "name": "PokePosts_",
                    "score": "0"
                },
                {
                    "rank": "93",
                    "name": "louishoodie",
                    "score": "0"
                },
                {
                    "rank": "94",
                    "name": "byshagrath_",
                    "score": "0"
                },
                {
                    "rank": "95",
                    "name": "giiipuff",
                    "score": "0"
                },
                {
                    "rank": "96",
                    "name": "osakaflakka",
                    "score": "0"
                },
                {
                    "rank": "97",
                    "name": "_eye5_",
                    "score": "0"
                },
                {
                    "rank": "98",
                    "name": "mreazi33",
                    "score": "0"
                }
            ],
            'trollalot': [
                {
                    "rank": "1",
                    "name": "akamoney_eth",
                    "score": "419"
                },
                {
                    "rank": "2",
                    "name": "mcvault11",
                    "score": "404"
                },
                {
                    "rank": "3",
                    "name": "atari_god",
                    "score": "400"
                },
                {
                    "rank": "4",
                    "name": "lunavonhresvelg",
                    "score": "381"
                },
                {
                    "rank": "5",
                    "name": "thepeacedout",
                    "score": "375"
                },
                {
                    "rank": "6",
                    "name": "wangbinfeng2",
                    "score": "372"
                },
                {
                    "rank": "7",
                    "name": "redwooddawg",
                    "score": "366"
                },
                {
                    "rank": "8",
                    "name": "kuyamark",
                    "score": "364"
                },
                {
                    "rank": "9",
                    "name": "polandjim",
                    "score": "364"
                },
                {
                    "rank": "10",
                    "name": "yulei___",
                    "score": "362"
                },
                {
                    "rank": "11",
                    "name": "lakoz_",
                    "score": "349"
                },
                {
                    "rank": "12",
                    "name": "spacecowboycat",
                    "score": "346"
                },
                {
                    "rank": "13",
                    "name": "robottiandrea",
                    "score": "340"
                },
                {
                    "rank": "14",
                    "name": "sumopickle",
                    "score": "339"
                },
                {
                    "rank": "15",
                    "name": "bene_bla",
                    "score": "332"
                },
                {
                    "rank": "16",
                    "name": "filippobazzoli",
                    "score": "332"
                },
                {
                    "rank": "17",
                    "name": "samplaysgolf",
                    "score": "322"
                },
                {
                    "rank": "18",
                    "name": "steven34568146",
                    "score": "315"
                },
                {
                    "rank": "19",
                    "name": "jasmarkangeles",
                    "score": "312"
                },
                {
                    "rank": "20",
                    "name": "ste85gra",
                    "score": "310"
                },
                {
                    "rank": "21",
                    "name": "reekjpeg",
                    "score": "272"
                },
                {
                    "rank": "22",
                    "name": "webmixgamer",
                    "score": "268"
                },
                {
                    "rank": "23",
                    "name": "lukey___pookie",
                    "score": "244"
                },
                {
                    "rank": "24",
                    "name": "poloman1982",
                    "score": "240"
                },
                {
                    "rank": "25",
                    "name": "iamshabbazz",
                    "score": "236"
                },
                {
                    "rank": "26",
                    "name": "pauncheth",
                    "score": "225"
                },
                {
                    "rank": "27",
                    "name": "___j___w_",
                    "score": "219"
                },
                {
                    "rank": "28",
                    "name": "faresnightnft",
                    "score": "213"
                },
                {
                    "rank": "29",
                    "name": "8270eth",
                    "score": "207"
                },
                {
                    "rank": "30",
                    "name": "maybepeykal",
                    "score": "171"
                },
                {
                    "rank": "31",
                    "name": "humpstyles",
                    "score": "156"
                },
                {
                    "rank": "32",
                    "name": "fernlovescrypto",
                    "score": "155"
                },
                {
                    "rank": "33",
                    "name": "barthazian",
                    "score": "151"
                },
                {
                    "rank": "34",
                    "name": "nfthoarder888",
                    "score": "148"
                },
                {
                    "rank": "35",
                    "name": "chickenwizardx",
                    "score": "141"
                },
                {
                    "rank": "36",
                    "name": "ksk2088394",
                    "score": "139"
                },
                {
                    "rank": "37",
                    "name": "minnesotahaze",
                    "score": "132"
                },
                {
                    "rank": "38",
                    "name": "p3te_eth",
                    "score": "128"
                },
                {
                    "rank": "39",
                    "name": "fiscalbits",
                    "score": "128"
                },
                {
                    "rank": "40",
                    "name": "__diso",
                    "score": "73"
                },
                {
                    "rank": "41",
                    "name": "dgtlemissions",
                    "score": "71"
                },
                {
                    "rank": "42",
                    "name": "bibdieu",
                    "score": "57"
                },
                {
                    "rank": "43",
                    "name": "godbreakerbtc",
                    "score": "57"
                },
                {
                    "rank": "44",
                    "name": "nftspooky",
                    "score": "53"
                },
                {
                    "rank": "45",
                    "name": "heytedward",
                    "score": "39"
                },
                {
                    "rank": "46",
                    "name": "ladyapefundy",
                    "score": "39"
                },
                {
                    "rank": "47",
                    "name": "solarsoundwave",
                    "score": "32"
                },
                {
                    "rank": "48",
                    "name": "zx07353502",
                    "score": "28"
                },
                {
                    "rank": "49",
                    "name": "duis_eth",
                    "score": "27"
                },
                {
                    "rank": "50",
                    "name": "wendy58152",
                    "score": "26"
                },
                {
                    "rank": "51",
                    "name": "bbtntwrk",
                    "score": "17"
                },
                {
                    "rank": "52",
                    "name": "henftee",
                    "score": "14"
                },
                {
                    "rank": "53",
                    "name": "drari1080",
                    "score": "14"
                },
                {
                    "rank": "54",
                    "name": "jj_br0ther",
                    "score": "10"
                },
                {
                    "rank": "55",
                    "name": "plckleap",
                    "score": "9"
                },
                {
                    "rank": "56",
                    "name": "alleycatnft",
                    "score": "9"
                },
                {
                    "rank": "57",
                    "name": "0xamica",
                    "score": "8"
                },
                {
                    "rank": "58",
                    "name": "rezzonico",
                    "score": "5"
                },
                {
                    "rank": "59",
                    "name": "fundyape3659",
                    "score": "4"
                },
                {
                    "rank": "60",
                    "name": "niftymateo",
                    "score": "3"
                },
                {
                    "rank": "61",
                    "name": "olucrown1402",
                    "score": "0"
                },
                {
                    "rank": "62",
                    "name": "laudomiamedici",
                    "score": "0"
                },
                {
                    "rank": "63",
                    "name": "holonaut0",
                    "score": "0"
                },
                {
                    "rank": "64",
                    "name": "ambrosiniiiii",
                    "score": "0"
                },
                {
                    "rank": "65",
                    "name": "crypt0xninja",
                    "score": "0"
                },
                {
                    "rank": "66",
                    "name": "gabrielnovaes88",
                    "score": "0"
                },
                {
                    "rank": "67",
                    "name": "vhils1",
                    "score": "0"
                },
                {
                    "rank": "68",
                    "name": "aaronr5274",
                    "score": "0"
                },
                {
                    "rank": "69",
                    "name": "arduieth",
                    "score": "0"
                },
                {
                    "rank": "70",
                    "name": "boredpan888",
                    "score": "0"
                },
                {
                    "rank": "71",
                    "name": "kidgonzo",
                    "score": "0"
                },
                {
                    "rank": "72",
                    "name": "weekendtrader1",
                    "score": "0"
                }
            ]
        };

        // Data storage
        let allData = {};
        let currentChart = null;
        const rowsPerPage = 10;
        let currentPage = 1;
        let currentTableData = [];
        let currentTableDataset = 'all';
        let searchQuery = '';

        // Store the last displayed statistics for animations
        let currentStats = {
            totalUsers: 0,
            totalScore: 0,
            avgScore: 0,
            maxScore: 0,
            medianScore: 0,
            zeroScores: 0,
            zeroScorePercentage: 0
        };

        // Department manager mapping
        const departmentManagers = {
            'bully': 'Bully The Kid',
            'doxmuddler': 'Dox Muddler',
            'negativenancy': 'Negative Nancy',
            'trollalot': 'Sir TrollzALot'
        };

        // Manager icons mapping
        const managerIcons = {
            'bully': 'images/bully_overlord_noicon.webp',
            'doxmuddler': 'images/conspiracy_overlord_no_icon.webp',
            'negativenancy': 'images/bearish_overlord_noicon.webp',
            'trollalot': 'images/troll_overlord_no_icon.webp'
        };

        // Initialize data from inline JSON
        function loadData() {
            // Process raw data and convert strings to numbers
            for (const [dataset, data] of Object.entries(rawData)) {
                allData[dataset] = data.map(item => ({
                    ...item,
                    score: parseInt(item.score),
                    rank: parseInt(item.rank),
                    departmentManager: departmentManagers[dataset]
                }));
            }

            // Initial chart render and department rankings
            updateDepartmentRankings();
            updateVisualization();
        }

        // Update department rankings card
        function updateDepartmentRankings() {
            const departmentStats = [];

            // Calculate stats for each department
            for (const [dataset, data] of Object.entries(allData)) {
                const scores = data.map(item => item.score);
                const totalScore = scores.reduce((a, b) => a + b, 0);
                const userCount = data.length;
                const avgScore = totalScore / userCount;
                const maxScore = Math.max(...scores);
                const topUser = data.find(user => user.score === maxScore);

                departmentStats.push({
                    dataset,
                    name: departmentManagers[dataset],
                    totalScore,
                    userCount,
                    avgScore,
                    maxScore,
                    topUser: topUser.name,
                    icon: managerIcons[dataset]
                });
            }

            // Sort by total score (descending)
            departmentStats.sort((a, b) => b.totalScore - a.totalScore);

            // Update the UI
            const container = document.getElementById('departmentRankings');
            container.innerHTML = '';

            departmentStats.forEach((dept, index) => {
                const rank = index + 1;
                const card = document.createElement('div');
                card.className = `dept-rank-card rank-${rank}`;
                card.setAttribute('data-department', dept.dataset);

                card.innerHTML = `
                    <div class="dept-rank-number rank-${rank}">${rank}</div>
                    <div class="dept-manager-info">
                        <img src="${dept.icon}" alt="${dept.name}" class="dept-manager-icon">
                        <div>
                            <div class="font-semibold text-gray-900">${dept.name}</div>
                            <div class="text-xs text-gray-600">Top: ${dept.topUser}</div>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Total Score:</span>
                            <span class="font-semibold">${dept.totalScore.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Users:</span>
                            <span class="font-semibold">${dept.userCount}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Avg Score:</span>
                            <span class="font-semibold">${dept.avgScore.toFixed(1)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">Max Score:</span>
                            <span class="font-semibold">${dept.maxScore.toLocaleString()}</span>
                        </div>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Create rank distribution data (users ranked by score)
        function createPowerLawData(data) {
            // Sort users by score in descending order
            const sortedData = [...data].sort((a, b) => b.score - a.score);

            // Create labels and scores arrays
            const labels = sortedData.map((_, index) => `Rank ${index + 1}`);
            const scores = sortedData.map(user => user.score);

            return { labels, scores, sortedData };
        }

        // Create histogram data
        function createHistogramData(data, binSize) {
            const scores = data.map(item => item.score);
            const maxScore = Math.max(...scores);
            const minScore = Math.min(...scores);

            // Create bins
            const bins = [];
            for (let i = minScore; i <= maxScore; i += binSize) {
                bins.push({
                    min: i,
                    max: i + binSize - 1,
                    count: 0,
                    label: `${i}-${i + binSize - 1}`
                });
            }

            // Count scores in each bin
            scores.forEach(score => {
                const binIndex = Math.floor((score - minScore) / binSize);
                if (bins[binIndex]) {
                    bins[binIndex].count++;
                }
            });

            return bins;
        }

        // Animate a number from start to end
        function animateNumber(id, start, end, formatFn, duration = 500) {
            const el = document.getElementById(id);
            if (!el) return;
            const startTime = performance.now();

            function update(now) {
                const progress = Math.min((now - startTime) / duration, 1);
                const value = start + (end - start) * progress;
                el.textContent = formatFn(value);
                if (progress < 1) requestAnimationFrame(update);
            }

            requestAnimationFrame(update);
        }

        // Animate zero score count and percentage
        function animateZeroScores(startCount, endCount, startPct, endPct, duration = 500) {
            const el = document.getElementById('zeroScores');
            const startTime = performance.now();

            function update(now) {
                const progress = Math.min((now - startTime) / duration, 1);
                const val = startCount + (endCount - startCount) * progress;
                const pctVal = startPct + (endPct - startPct) * progress;
                el.textContent = `${Math.round(val).toLocaleString()} (${pctVal.toFixed(1)}%)`;
                if (progress < 1) requestAnimationFrame(update);
            }

            requestAnimationFrame(update);
        }

        // Update statistics
        function updateStats(data) {
            const scores = data.map(item => item.score);
            const totalUsers = data.length;
            const totalScore = scores.reduce((a, b) => a + b, 0);
            const avgScore = totalScore / totalUsers;
            const maxScore = Math.max(...scores);
            const zeroScores = scores.filter(score => score === 0).length;

            // Calculate median
            const sortedScores = [...scores].sort((a, b) => a - b);
            const medianScore = sortedScores.length % 2 === 0
                ? (sortedScores[sortedScores.length / 2 - 1] + sortedScores[sortedScores.length / 2]) / 2
                : sortedScores[Math.floor(sortedScores.length / 2)];

            const zeroScorePercentage = (zeroScores / totalUsers) * 100;

            animateNumber('totalUsers', currentStats.totalUsers, totalUsers, v => Math.round(v).toLocaleString());
            animateNumber('totalScore', currentStats.totalScore, totalScore, v => Math.round(v).toLocaleString());
            animateNumber('avgScore', currentStats.avgScore, avgScore, v => v.toFixed(1));
            animateNumber('maxScore', currentStats.maxScore, maxScore, v => Math.round(v).toLocaleString());
            animateNumber('medianScore', currentStats.medianScore, medianScore, v => Math.round(v).toLocaleString());
            animateZeroScores(currentStats.zeroScores, zeroScores, currentStats.zeroScorePercentage, zeroScorePercentage);

            currentStats = {
                totalUsers,
                totalScore,
                avgScore,
                maxScore,
                medianScore,
                zeroScores,
                zeroScorePercentage
            };
        }

        // Update top performers table
        function updateTopPerformers(data, selectedDataset) {
            const filteredData = data.filter(user =>
                user.name.toLowerCase().includes(searchQuery)
            );
            const sortedData = [...filteredData].sort((a, b) => b.score - a.score);

            // Calculate global ranks if "All" is selected, otherwise preserve original ranks
            let dataWithRanks;
            if (selectedDataset === 'all') {
                // Create a map of all users sorted by score to get global ranks
                const allSortedData = [...data].sort((a, b) => b.score - a.score);
                const globalRankMap = new Map();
                allSortedData.forEach((user, index) => {
                    const key = `${user.name}_${user.score}_${user.departmentManager}`;
                    globalRankMap.set(key, index + 1);
                });

                // Apply global ranks to sorted data
                dataWithRanks = sortedData.map(user => ({
                    ...user,
                    globalRank: globalRankMap.get(`${user.name}_${user.score}_${user.departmentManager}`)
                }));
            } else {
                // Use original department ranks
                dataWithRanks = sortedData;
            }

            currentTableData = dataWithRanks;
            currentTableDataset = selectedDataset;
            const totalPages = Math.max(1, Math.ceil(dataWithRanks.length / rowsPerPage));
            if (currentPage > totalPages) currentPage = totalPages;
            const startIndex = (currentPage - 1) * rowsPerPage;
            const pageData = dataWithRanks.slice(startIndex, startIndex + rowsPerPage);

            const tableBody = document.getElementById('topPerformersTable');
            tableBody.innerHTML = '';

            // Update performers icon
            const performersIconElement = document.getElementById('performersIcon');
            const datasetName = selectedDataset === 'all' ? 'All Departments' :
                (departmentManagers[selectedDataset] || selectedDataset);

            if (selectedDataset !== 'all' && managerIcons[selectedDataset]) {
                performersIconElement.innerHTML = `<img src="${managerIcons[selectedDataset]}" alt="${datasetName}" class="manager-icon">`;
            } else {
                performersIconElement.innerHTML = '';
            }

            pageData.forEach((user, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b hover:bg-gray-50';

                const departmentManager = user.departmentManager || 'Unknown';
                const displayRank = selectedDataset === 'all' ? user.globalRank : user.rank;

                row.innerHTML = `
                    <td class="py-2 px-4">${displayRank}</td>
                    <td class="py-2 px-4 font-medium">${user.name}</td>
                    <td class="py-2 px-4">${user.score.toLocaleString()}</td>
                    <td class="py-2 px-4">
                        <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                            ${departmentManager}
                        </span>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Update pagination info
            document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

        // Update chart and visualization
        function updateVisualization() {
            const selectedDataset = document.getElementById('datasetSelect').value;
            const chartType = document.getElementById('chartType').value;
            const binSize = parseInt(document.getElementById('binSize').value || 25);

            currentPage = 1;

            // Show/hide bin size selector based on chart type
            const binSizeContainer = document.getElementById('binSizeContainer');
            binSizeContainer.style.display = chartType === 'histogram' ? 'block' : 'none';

            let data = [];
            let datasetName = '';

            if (selectedDataset === 'all') {
                // Combine all datasets
                data = Object.values(allData).flat();
                datasetName = 'All Departments';
            } else {
                data = allData[selectedDataset] || [];
                datasetName = departmentManagers[selectedDataset] ||
                    (selectedDataset.charAt(0).toUpperCase() +
                        selectedDataset.slice(1).replace('-', ' '));
            }

            if (data.length === 0) return;

            // Update chart title and description
            const chartTitle = document.getElementById('chartTitle');
            const chartDescription = document.getElementById('chartDescription');

            if (chartType === 'powerlaw') {
                chartTitle.textContent = 'Score Distribution (Rank Distribution)';
                chartDescription.textContent = 'Users ranked by score (highest to lowest) to visualize score concentration';
            } else {
                chartTitle.textContent = 'Score Distribution Histogram';
                chartDescription.textContent = 'Distribution of user scores across the selected department(s)';
            }

            // Update statistics
            updateStats(data);

            // Update top performers
            updateTopPerformers(data, selectedDataset);

            // Update chart
            const ctx = document.getElementById('histogramChart').getContext('2d');

            if (currentChart) {
                currentChart.destroy();
            }

            // Update histogram icon
            const histogramIconElement = document.getElementById('histogramIcon');
            if (selectedDataset !== 'all' && managerIcons[selectedDataset]) {
                histogramIconElement.innerHTML = `<img src="${managerIcons[selectedDataset]}" alt="${datasetName}" class="manager-icon">`;
            } else {
                histogramIconElement.innerHTML = '';
            }

            if (chartType === 'powerlaw') {
                // Create power law data
                const powerLawData = createPowerLawData(data);

                currentChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: powerLawData.labels,
                        datasets: [{
                            label: 'User Score',
                            data: powerLawData.scores,
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 2,
                            fill: true,
                            pointRadius: 0,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            title: {
                                display: true,
                                text: `Rank Distribution - ${datasetName}`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: false
                            },
                            tooltip: {
                                callbacks: {
                                    title: function (context) {
                                        const index = context[0].dataIndex;
                                        const user = powerLawData.sortedData[index];
                                        return `Rank #${index + 1}: ${user.name}`;
                                    },
                                    label: function (context) {
                                        return `Score: ${context.parsed.y.toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Score'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'User Rank (Highest to Lowest Score)'
                                },
                                ticks: {
                                    maxTicksLimit: 10
                                }
                            }
                        }
                    }
                });
            } else {
                // Create histogram data
                const histogramData = createHistogramData(data, binSize);

                currentChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: histogramData.map(bin => bin.label),
                        datasets: [{
                            label: 'Number of Users',
                            data: histogramData.map(bin => bin.count),
                            backgroundColor: 'rgba(59, 130, 246, 0.6)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `Score Distribution - ${datasetName}`,
                                font: {
                                    size: 16,
                                    weight: 'bold'
                                }
                            },
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Number of Users'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Score Range'
                                }
                            }
                        }
                    }
                });
            }
        }

        // Event listeners
        document.getElementById('datasetSelect').addEventListener('change', updateVisualization);
        document.getElementById('chartType').addEventListener('change', updateVisualization);
        document.getElementById('binSize').addEventListener('change', updateVisualization);
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                updateTopPerformers(currentTableData, currentTableDataset);
            }
        });
        document.getElementById('nextPage').addEventListener('click', () => {
            const totalPages = Math.max(1, Math.ceil(currentTableData.length / rowsPerPage));
            if (currentPage < totalPages) {
                currentPage++;
                updateTopPerformers(currentTableData, currentTableDataset);
            }
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchQuery = e.target.value.toLowerCase();
            currentPage = 1;
            const selectedDataset = document.getElementById('datasetSelect').value;
            let data = [];
            if (selectedDataset === 'all') {
                data = Object.values(allData).flat();
            } else {
                data = allData[selectedDataset] || [];
            }
            updateTopPerformers(data, selectedDataset);
        });

        // Initialize
        loadData();
    </script>
</body>

</html>